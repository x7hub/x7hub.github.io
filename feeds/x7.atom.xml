<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>x7's blog - x7</title><link href="https://x7blog.info/" rel="alternate"></link><link href="https://x7blog.info/feeds/x7.atom.xml" rel="self"></link><id>https://x7blog.info/</id><updated>2017-12-12T00:00:00+08:00</updated><entry><title>反编译微信Android客户端并重新打包</title><link href="https://x7blog.info/archives/recompile_wechat_6513.html" rel="alternate"></link><published>2017-12-12T00:00:00+08:00</published><updated>2017-12-12T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2017-12-12:/archives/recompile_wechat_6513.html</id><summary type="html">&lt;p&gt;参考:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://x-wei.github.io/pelican_github_blog.html"&gt;微信安卓客户端逆向分析 by impakho&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.jianshu.com/p/a0e6b3f15d78"&gt;微信的二次打包 by manmade&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;工具&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;微信版本&lt;code&gt;6.5.13&lt;/code&gt;.&lt;a href="http://dldir1.qq.com/weixin/android/weixin6514android1120.apk"&gt;官方下载地址&lt;/a&gt;，文件名叫6514，实际在应用内显示版本为6.5.13。其他相近的版本原理相似，但是由于代码混淆机制，可能对应的包名类名不同。&lt;/li&gt;
&lt;li&gt;Apktool &lt;code&gt;2.2.4&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;jadx &lt;code&gt;0.6.1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;jdk &lt;code&gt;1.8.0_151&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;反编译&lt;/h3&gt;
&lt;p&gt;如果直接默认选项反编译，那么在重新打包时会遇到资源文件错误的问题，所以尝试用&lt;code&gt;-r&lt;/code&gt;参数保留资源文件。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;java -jar .&lt;span class="se"&gt;\a&lt;/span&gt;pktool&lt;span class="se"&gt;\a&lt;/span&gt;pktool_2.2.4.jar  d -r .&lt;span class="se"&gt;\w …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;参考:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://x-wei.github.io/pelican_github_blog.html"&gt;微信安卓客户端逆向分析 by impakho&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.jianshu.com/p/a0e6b3f15d78"&gt;微信的二次打包 by manmade&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;工具&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;微信版本&lt;code&gt;6.5.13&lt;/code&gt;.&lt;a href="http://dldir1.qq.com/weixin/android/weixin6514android1120.apk"&gt;官方下载地址&lt;/a&gt;，文件名叫6514，实际在应用内显示版本为6.5.13。其他相近的版本原理相似，但是由于代码混淆机制，可能对应的包名类名不同。&lt;/li&gt;
&lt;li&gt;Apktool &lt;code&gt;2.2.4&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;jadx &lt;code&gt;0.6.1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;jdk &lt;code&gt;1.8.0_151&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;反编译&lt;/h3&gt;
&lt;p&gt;如果直接默认选项反编译，那么在重新打包时会遇到资源文件错误的问题，所以尝试用&lt;code&gt;-r&lt;/code&gt;参数保留资源文件。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;java -jar .&lt;span class="se"&gt;\a&lt;/span&gt;pktool&lt;span class="se"&gt;\a&lt;/span&gt;pktool_2.2.4.jar  d -r .&lt;span class="se"&gt;\w&lt;/span&gt;eixin6514android1120.apk
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;反编译后的目录：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;total &lt;span class="m"&gt;3057&lt;/span&gt;
drwxr-xr-x &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:45 ./
drwxr-xr-x &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:42 ../
-rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;  &lt;span class="m"&gt;242032&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:42 AndroidManifest.xml
-rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt; &lt;span class="m"&gt;379&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:45 apktool.yml
drwxr-xr-x &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:45 assets/
drwxr-xr-x &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:45 lib/
drwxr-xr-x &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:45 original/
-rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt; &lt;span class="m"&gt;2831616&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:42 resources.arsc
drwxr-xr-x &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:44 smali/
drwxr-xr-x &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:44 smali_classes2/
drwxr-xr-x &lt;span class="m"&gt;1&lt;/span&gt; Sec &lt;span class="m"&gt;197121&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt; Dec &lt;span class="m"&gt;12&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;:45 smali_classes3/
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;微信相关的代码位于&lt;code&gt;smali/com/tencent/mm/&lt;/code&gt;。&lt;/p&gt;
&lt;h3&gt;签名检查&lt;/h3&gt;
&lt;p&gt;位于&lt;code&gt;smali/com/tencent/mm/d/a.smali&lt;/code&gt;中的第&lt;code&gt;793&lt;/code&gt;行。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;if-eqz &lt;span class="nb"&gt;v0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nl"&gt;:cond_2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;直接删掉就可以跳过检查。&lt;/p&gt;
&lt;h3&gt;简单修改&lt;/h3&gt;
&lt;p&gt;对代码做一些简单的修改，以打印内部日志为例。&lt;/p&gt;
&lt;p&gt;对于日志输出的分析，参考&lt;a href="https://impakho.com/2017/02/22/wechat-android-client-hack/"&gt;这篇文章&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;日志类在&lt;code&gt;smali/com/tencent/mm/sdk/platformtools/v.smali&lt;/code&gt;，其中的&lt;code&gt;d&lt;/code&gt;、&lt;code&gt;i&lt;/code&gt;等方法中，都会调用&lt;code&gt;Lcom/tencent/mm/sdk/platformtools/v$a;-&amp;gt;getLogLevel()I&lt;/code&gt;方法，猜测是在检查日志输出级别的设置，
如果我们想要输出全部级别的日志，则需要在每个日志方法中，去掉对日志级别的检查，并用&lt;code&gt;android.util.Log&lt;/code&gt;打印日志到logcat。&lt;/p&gt;
&lt;p&gt;例如在&lt;code&gt;v&lt;/code&gt;方法中，第&lt;code&gt;532&lt;/code&gt;行的以下代码&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;.line&lt;/span&gt; &lt;span class="mi"&gt;265&lt;/span&gt;
sget-object &lt;span class="nb"&gt;v0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;L&lt;/span&gt;com/tencent/mm/sdk/platformtools/&lt;span class="nc"&gt;v&lt;/span&gt;;&lt;span class="p"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="nv"&gt;uqV&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="kt"&gt;L&lt;/span&gt;com/tencent/mm/sdk/platformtools/&lt;span class="nc"&gt;v$a&lt;/span&gt;;

if-eqz &lt;span class="nb"&gt;v0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nl"&gt;:cond_1&lt;/span&gt;

sget-object &lt;span class="nb"&gt;v0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;L&lt;/span&gt;com/tencent/mm/sdk/platformtools/&lt;span class="nc"&gt;v&lt;/span&gt;;&lt;span class="p"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="nv"&gt;uqV&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="kt"&gt;L&lt;/span&gt;com/tencent/mm/sdk/platformtools/&lt;span class="nc"&gt;v$a&lt;/span&gt;;

invoke-interface &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nb"&gt;v0&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="kt"&gt;L&lt;/span&gt;com/tencent/mm/sdk/platformtools/&lt;span class="nc"&gt;v$a&lt;/span&gt;;&lt;span class="p"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="nf"&gt;getLogLevel&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="kt"&gt;I&lt;/span&gt;

move-result &lt;span class="nb"&gt;v0&lt;/span&gt;

const/4 &lt;span class="nb"&gt;v1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0x1&lt;/span&gt;

if-gt &lt;span class="nb"&gt;v0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;v1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nl"&gt;:cond_1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;检查loglevel如果不够&lt;code&gt;1&lt;/code&gt;，则认为不该输出&lt;code&gt;v&lt;/code&gt;级别的日志，就跳转到了&lt;code&gt;:cond_1&lt;/code&gt;处，直接结束。&lt;/p&gt;
&lt;p&gt;时直接将这一段判断代码删除，以跳过检查。并且，找到第597行出现了一段代码&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;invoke-interface/range &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nb"&gt;v0&lt;/span&gt; &lt;span class="p"&gt;..&lt;/span&gt; &lt;span class="nb"&gt;v10&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="kt"&gt;L&lt;/span&gt;com/tencent/mm/sdk/platformtools/&lt;span class="nc"&gt;v$a&lt;/span&gt;;&lt;span class="p"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="nf"&gt;logD&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;L&lt;/span&gt;java/lang/&lt;span class="nc"&gt;String&lt;/span&gt;;&lt;span class="kt"&gt;L&lt;/span&gt;java/lang/&lt;span class="nc"&gt;String&lt;/span&gt;;&lt;span class="kt"&gt;L&lt;/span&gt;java/lang/&lt;span class="nc"&gt;String&lt;/span&gt;;&lt;span class="kt"&gt;IIJJL&lt;/span&gt;java/lang/&lt;span class="nc"&gt;String&lt;/span&gt;;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="kt"&gt;V&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;logD&lt;/code&gt;的调用明显是在输出日志内容，所以在此处插入一行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;invoke-static &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nb"&gt;p0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;v10&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="kt"&gt;L&lt;/span&gt;android/util/&lt;span class="nc"&gt;Log&lt;/span&gt;;&lt;span class="p"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="nf"&gt;d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;L&lt;/span&gt;java/lang/&lt;span class="nc"&gt;String&lt;/span&gt;;&lt;span class="kt"&gt;L&lt;/span&gt;java/lang/&lt;span class="nc"&gt;String&lt;/span&gt;;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="kt"&gt;I&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;输出&lt;code&gt;v10&lt;/code&gt;的内容到logcat。&lt;/p&gt;
&lt;p&gt;对于此类中的其他日志相关的方法，同样跳过检查并插入logcat输出，就可以在打包运行时看到内部的全部日志，能直接看到聊天显示内容和网络交互等内容，信息量很大。&lt;/p&gt;
&lt;h3&gt;打包&lt;/h3&gt;
&lt;p&gt;直接打包可以打包成功，并且可以安装，但是运行时会秒退，根据报错信息发现是缺少了资源文件。&lt;/p&gt;
&lt;p&gt;微信的资源文件位于&lt;code&gt;r&lt;/code&gt;目录，而不是默认的&lt;code&gt;res&lt;/code&gt;，在使用apktool反编译和打包的过程中出现了问题，没有将资源文件还原。一个简单的应对方案是直接将原来的&lt;code&gt;r&lt;/code&gt;目录塞到打包好的apk中。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;使用默认选项重新打包&lt;/p&gt;
&lt;p&gt;&lt;code&gt;java -jar .\apktool\apktool_2.2.4.jar b weixin6514android1120&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;其中会遇到报错&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[Fatal Error] :1:1: Content is not allowed in prolog.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;是正常显现，并没有影响&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用解压缩工具解压原本的apk文件，取出其中的&lt;code&gt;r&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用解压缩工具打开由apktool打包好的apk文件，将刚才的&lt;code&gt;r&lt;/code&gt;目录直接塞到apk中并保存。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;签名，对齐，安装&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这样修改后的微信就可以正常运行了。&lt;/p&gt;
&lt;h3&gt;下一步&lt;/h3&gt;
&lt;p&gt;微信的动态调试有问题，暂时只能使用插入日志的方式来调试。&lt;/p&gt;</content><category term="Android"></category></entry><entry><title>Emoji表情传输和保存：对非BMP范围的Unicode字符的处理</title><link href="https://x7blog.info/archives/php_emoji_to_unicode.html" rel="alternate"></link><published>2015-12-17T00:00:00+08:00</published><updated>2015-12-17T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2015-12-17:/archives/php_emoji_to_unicode.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/UTF-16"&gt;UTF-16&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Emoji"&gt;Emoji&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://cenalulu.github.io/linux/character-encoding/"&gt;十分钟搞清字符集和字符编码&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/27287369/4-byte-unicode-character-in-java"&gt;4 byte unicode character in Java&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Emoji与Unicode、UTF8&lt;/h2&gt;
&lt;p&gt;Emoji是一种特殊的字符，而不是像QQ表情一样的普通字符的转义表示。在Unicode编码中，占用了&lt;code&gt;U+1F300&lt;/code&gt;到&lt;code&gt;U+1F64F&lt;/code&gt;中的&lt;a href="https://en.wikipedia.org/wiki/Emoji#Unicode_Blocks"&gt;部分范围&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Emoji字符的特殊之处在于，其使用的Unicode字符超出了通常使用的三字节UTF-8编码的Unicode范围，即BMP范围&lt;code&gt;U+0000&lt;/code&gt;到&lt;code&gt;U+FFFF&lt;/code&gt;。按照&lt;a href="https://en.wikipedia.org/wiki/UTF-8#Codepage_layout"&gt;UTF-8编码规范&lt;/a&gt;，Emoji字符属于辅助平面范围，通常对应4字节的UTF-8编码。&lt;/p&gt;
&lt;h2&gt;Android上Emoji的特殊表示&lt;/h2&gt;
&lt;p&gt;在Android上显示Emoji出现问题根源在于Java的char长度是两个字节，因此不能直接表示BMP范围外的Unicode字符，包括Emoji。对于BMP范围外的字符，Java没有直接编码的方案，而是&lt;a href="http://stackoverflow.com/questions/27287369/4-byte-unicode-character-in-java"&gt;采用一种替代手段&lt;/a&gt;，使用两个char来表示一个字符，称为high surrogate和low surrogate。其中high surrogate使用的是&lt;code&gt;U …&lt;/code&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/UTF-16"&gt;UTF-16&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Emoji"&gt;Emoji&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://cenalulu.github.io/linux/character-encoding/"&gt;十分钟搞清字符集和字符编码&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/27287369/4-byte-unicode-character-in-java"&gt;4 byte unicode character in Java&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Emoji与Unicode、UTF8&lt;/h2&gt;
&lt;p&gt;Emoji是一种特殊的字符，而不是像QQ表情一样的普通字符的转义表示。在Unicode编码中，占用了&lt;code&gt;U+1F300&lt;/code&gt;到&lt;code&gt;U+1F64F&lt;/code&gt;中的&lt;a href="https://en.wikipedia.org/wiki/Emoji#Unicode_Blocks"&gt;部分范围&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;Emoji字符的特殊之处在于，其使用的Unicode字符超出了通常使用的三字节UTF-8编码的Unicode范围，即BMP范围&lt;code&gt;U+0000&lt;/code&gt;到&lt;code&gt;U+FFFF&lt;/code&gt;。按照&lt;a href="https://en.wikipedia.org/wiki/UTF-8#Codepage_layout"&gt;UTF-8编码规范&lt;/a&gt;，Emoji字符属于辅助平面范围，通常对应4字节的UTF-8编码。&lt;/p&gt;
&lt;h2&gt;Android上Emoji的特殊表示&lt;/h2&gt;
&lt;p&gt;在Android上显示Emoji出现问题根源在于Java的char长度是两个字节，因此不能直接表示BMP范围外的Unicode字符，包括Emoji。对于BMP范围外的字符，Java没有直接编码的方案，而是&lt;a href="http://stackoverflow.com/questions/27287369/4-byte-unicode-character-in-java"&gt;采用一种替代手段&lt;/a&gt;，使用两个char来表示一个字符，称为high surrogate和low surrogate。其中high surrogate使用的是&lt;code&gt;U+D800&lt;/code&gt;–&lt;code&gt;U+DBFF&lt;/code&gt;，low surrogate使用的是&lt;code&gt;U+DC00&lt;/code&gt;-&lt;code&gt;U+DFFF&lt;/code&gt;，这两个范围都是Unicode编码的保留范围，专门用于表示surrogate字符。&lt;/p&gt;
&lt;p&gt;举个栗子，Unicode编码为&lt;code&gt;U+1F602&lt;/code&gt;的Emoji符号。&lt;/p&gt;
&lt;p&gt;&lt;img alt="Face With Tears of Joy" src="https://emojipedia-us.s3.amazonaws.com/cache/3e/a3/3ea3af3cf1f2a75b62bec201c87cd995.png"&gt;&lt;/p&gt;
&lt;p&gt;在Java中看一下对它的存储和编码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;tear&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Character&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toChars&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="mh"&gt;0x1F602&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// Face with Tears of Joy&lt;/span&gt;
&lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tear&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;byteLength&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBytes&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;StandardCharsets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF_8&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;escape&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;StringEscapeUtils&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;escapeJava&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;

&lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;s &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;length &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;byteLength &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;byteLength&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;escape &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;escape&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;输出如下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;12-18 14:37:11.437 28246-28246/info.x7res.myapplication I/MainActivity: s ��
12-18 14:37:11.437 28246-28246/info.x7res.myapplication I/MainActivity: length 2
12-18 14:37:11.437 28246-28246/info.x7res.myapplication I/MainActivity: byteLength 4
12-18 14:37:11.437 28246-28246/info.x7res.myapplication I/MainActivity: escape \uD83D\uDE02
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;String对象的长度为&lt;code&gt;2&lt;/code&gt;，编码为UTF-8字节数组后长度为&lt;code&gt;4&lt;/code&gt;，单个字符unicode-escape编码结果为&lt;code&gt;\uD83D\uDE02&lt;/code&gt;。因此，虽然Java不能支持直接用单个Unicode字符表示Emoji表情，但是通过使用两个surrogate字符的替代方案也能很好的支持Emoji表情的保存和编码显示。&lt;/p&gt;
&lt;h2&gt;Lua对Emoji字符串的处理&lt;/h2&gt;
&lt;p&gt;Lua的字符串只能是ANSI编码，不支持Unicode字符的字符串。本节下文是在&lt;a href="https://www.zybuluo.com/miniknife/note/148136"&gt;触动精灵&lt;/a&gt;框架下，在Android上的Lua解释器测试得到的结论。&lt;/p&gt;
&lt;p&gt;在Lua中，一个Emoji字符是6个字节长度，而不是直接UTF-8编码得到的4个字节。这是在Java两个surrogate字符表示一个Emoji字符的基础上，又对这两个surrogate字符进行标准UTF-8编码，得到的6个字节的字符串。&lt;/p&gt;
&lt;h2&gt;PHP对Emoji字符的接收和保存&lt;/h2&gt;
&lt;p&gt;对于Android或者Lua经过urlencode上传的Emoji字符，在服务器的PHP上经过自动的urldecode会得到6个字节长度的2个字符，这里的表现是与Android相匹配的。&lt;/p&gt;
&lt;p&gt;问题出现在数据保存，虽然MySQL提供的utf8mb4编码支持4字节的UTF-8字符，但是要做匹配的另一批数据保存到了MongoDB，中文字符保存在成json格式时自动转为了unicode-escape编码，不能支持多字节的UTF-8字符或非BMP的unicode字符。因此为了与其他平台的数据做匹配，要求按照unicode-escape编码数据，即要求将&lt;code&gt;U+1F602&lt;/code&gt;编码为&lt;code&gt;\uD83D\uDE02&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;PHP并没有提供Python一样便利的编解码，而且也并不认为现unicode-escape是一种编码格式，因此没有直接encode字符串的方法。对于普通的BMP范围内的字符，比如中文字符，可以通过&lt;code&gt;json_encode&lt;/code&gt;方法&lt;a href="http://stackoverflow.com/questions/7381900/php-decoding-and-encoding-json-with-unicode-characters"&gt;实现unicode-escape编码&lt;/a&gt;，与Python的处理方式类似。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;$nickname_unicode = trim(json_encode($nickname), &amp;#39;&amp;quot;&amp;#39;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然而，与Python不同的是，PHP(5.6)的&lt;code&gt;json_encode&lt;/code&gt;方法认为&lt;code&gt;U+D800&lt;/code&gt;-&lt;code&gt;U+DFFF&lt;/code&gt;的范围是非法的，不能处理带有上述6字节Emoji符号的字符串，这样会得到空的结果。所以要实现保留字段的unicode-escape编码，需要重写&lt;code&gt;json_encode&lt;/code&gt;方法。这里参考了&lt;a href="https://github.com/amekkawi/diskusagereports/blob/master/scripts/inc/json_encode.php"&gt;一个开源项目的一部分代码&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;重写的&lt;code&gt;json_encode&lt;/code&gt;代码放在了&lt;a href="https://gist.github.com/x7hub/32615114d4a540d64502"&gt;我的gist&lt;/a&gt;，注意与原本的参考代码不同的是，173-175行的&lt;code&gt;mb_convert_encoding&lt;/code&gt;被注释掉，否则将使用PHP自带的&lt;code&gt;mb_convert_encoding&lt;/code&gt;方法，对于Unicode保留字符同样不能正常编码。&lt;/p&gt;</content><category term="Emoji"></category><category term="Unicode"></category><category term="PHP"></category><category term="Lua"></category></entry><entry><title>MonkeyRunner利用剪贴板输入中文</title><link href="https://x7blog.info/archives/monkeyrunner_input_unicode.html" rel="alternate"></link><published>2015-08-17T00:00:00+08:00</published><updated>2015-08-17T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2015-08-17:/archives/monkeyrunner_input_unicode.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="http://developer.android.com/tools/help/MonkeyRunner.html"&gt;MonkeyRunner&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/14243427/set-clipboard-text-via-adb-shell-as-of-api-level-11"&gt;Set clipboard text via adb shell as of API level 11&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Monkeyrunner不支持中文直接输入&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://developer.android.com/tools/help/MonkeyRunner.html"&gt;MonkeyRunner&lt;/a&gt;是一组&lt;a href="http://www.jython.org/docs/tutorial/indexprogress.html"&gt;Jython&lt;/a&gt;环境的Android自动测试工具，通过USB控制Android设备完成点击、拖拽、输入等操作。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MonkeyDevice&lt;/code&gt;类的&lt;code&gt;type(String message)&lt;/code&gt;方法支持向设备输入字符串，但是由于Jython本身的原因，无法支持直接输入unicode字符，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MonkeyRunner&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitForConnection&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 成功&lt;/span&gt;
&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;测试&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 无输入&lt;/span&gt;
&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;测试&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 无输入&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;解决的思路有两个，&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;利用Android设备上的输入法输入中文，相对复杂。&lt;/li&gt;
&lt;li&gt;利用剪贴板复制粘贴。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;下文实现的是利用剪贴板的思路 …&lt;/p&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="http://developer.android.com/tools/help/MonkeyRunner.html"&gt;MonkeyRunner&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/14243427/set-clipboard-text-via-adb-shell-as-of-api-level-11"&gt;Set clipboard text via adb shell as of API level 11&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Monkeyrunner不支持中文直接输入&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://developer.android.com/tools/help/MonkeyRunner.html"&gt;MonkeyRunner&lt;/a&gt;是一组&lt;a href="http://www.jython.org/docs/tutorial/indexprogress.html"&gt;Jython&lt;/a&gt;环境的Android自动测试工具，通过USB控制Android设备完成点击、拖拽、输入等操作。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MonkeyDevice&lt;/code&gt;类的&lt;code&gt;type(String message)&lt;/code&gt;方法支持向设备输入字符串，但是由于Jython本身的原因，无法支持直接输入unicode字符，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MonkeyRunner&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;waitForConnection&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 成功&lt;/span&gt;
&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;测试&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 无输入&lt;/span&gt;
&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;测试&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# 无输入&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;解决的思路有两个，&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;利用Android设备上的输入法输入中文，相对复杂。&lt;/li&gt;
&lt;li&gt;利用剪贴板复制粘贴。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;下文实现的是利用剪贴板的思路。&lt;/p&gt;
&lt;h3&gt;利用剪贴板输入中文&lt;/h3&gt;
&lt;p&gt;由PC机通过adb发送中文到Android设备，在设备上接收并将文字放入剪贴板，再通过monkeyrunner控制粘贴到文本框。&lt;/p&gt;
&lt;h4&gt;由adb传入中文字符&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;am startservice&lt;/code&gt;命令可以启指定的Service并传入Extra参数，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;adb shell am startservice -e &lt;span class="s2"&gt;&amp;quot;text&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;$message&lt;/span&gt; info.x7res.clip/.ClipService
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;info.x7res.clip&lt;/code&gt;是应用包名，&lt;code&gt;ClipService&lt;/code&gt;是接收文字的Service，&lt;code&gt;text&lt;/code&gt;是传入的StringExtra的键。&lt;/p&gt;
&lt;p&gt;此处可以直接传入中文，不过为了考虑对Windows的字符编码的兼容性问题，这里传入的是经过&lt;code&gt;unicode-escape&lt;/code&gt;编码后的ascii字符，在下一步设备上接收时再还原成中文。&lt;/p&gt;
&lt;h4&gt;Android应用接收并放入剪贴板&lt;/h4&gt;
&lt;p&gt;用Service在后台接收&lt;code&gt;am startservice&lt;/code&gt;命令传入的Extra参数，需要实现&lt;code&gt;onStartCommand&lt;/code&gt;方法，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;
&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;onStartCommand&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Intent&lt;/span&gt; &lt;span class="n"&gt;intent&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;startId&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;onStartCommand&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;intent&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;startId&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;intent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getStringExtra&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;text: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;textConverted&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;unicodeEscape&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;textConverted: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;textConverted&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setClip&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;textConverted&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;stopSelf&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;START_NOT_STICKY&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;unicode-escape的解码可以用&lt;code&gt;org.apache.commons.lang&lt;/code&gt;库中的&lt;code&gt;StringEscapeUtils.unescapeJava(input)&lt;/code&gt;方法。&lt;/p&gt;
&lt;p&gt;复制到剪贴板，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;setClip&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;ClipboardManager&lt;/span&gt; &lt;span class="n"&gt;clipboard&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ClipboardManager&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="n"&gt;getSystemService&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;CLIPBOARD_SERVICE&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;ClipData&lt;/span&gt; &lt;span class="n"&gt;clip&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ClipData&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;newPlainText&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;simple text&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;clipboard&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setPrimaryClip&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clip&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;monkeyrunner手势控制粘贴&lt;/h4&gt;
&lt;p&gt;在文本框上长按，出现粘贴按钮，点击按钮粘贴。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;view_point&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;HierarchyViewer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getAbsolutePositionOfView&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;offset_x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;
&lt;span class="n"&gt;offset_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;
&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;drag&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;view_point&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset_x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;view_point&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset_y&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
                &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;view_point&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset_x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;view_point&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset_y&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;offset_x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;50&lt;/span&gt;
&lt;span class="n"&gt;offset_y&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;
&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;touch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;view_point&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset_x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;view_point&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;offset_y&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;MonkeyDevice&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DOWN_AND_UP&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\033&lt;/span&gt;&lt;span class="s1"&gt;[1;32m-&amp;gt; &lt;/span&gt;&lt;span class="se"&gt;\033&lt;/span&gt;&lt;span class="s1"&gt;[0m&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot; text pasted&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;长按是利用原地的&lt;code&gt;drag&lt;/code&gt;实现的。如果利用&lt;code&gt;press&lt;/code&gt;的&lt;code&gt;DOWN&lt;/code&gt;和&lt;code&gt;UP&lt;/code&gt;方法不能实现长按效果。&lt;/p&gt;
&lt;p&gt;其中的offset值都是经验值，文本框的编辑位置一般位于&lt;code&gt;getAbsolutePositionOfView&lt;/code&gt;右下，而长按出现的粘贴按钮一般位于右上。&lt;/p&gt;</content><category term="Android MonkeyRunner"></category></entry><entry><title>Python2字符编码问题小结</title><link href="https://x7blog.info/archives/python2_encoding.html" rel="alternate"></link><published>2015-05-29T00:00:00+08:00</published><updated>2015-05-29T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2015-05-29:/archives/python2_encoding.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.python.org/2/howto/unicode.html"&gt;Python docs - Unicode HOWTO&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.python.org/2/library/stdtypes.html"&gt;Python docs - Built-in Types&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/2596714/why-does-python-print-unicode-characters-when-the-default-encoding-is-ascii"&gt;Stack Overflow - Why does Python print unicode characters when the default encoding is ASCII?&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;理论&lt;/h2&gt;
&lt;h3&gt;编码中的Unicode和UTF-8&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Unicode&lt;/code&gt;是字符集，&lt;code&gt;UTF-8&lt;/code&gt;是&lt;code&gt;Unicode&lt;/code&gt;的一种编码方式，并列的还包括&lt;code&gt;UTF-16&lt;/code&gt;、&lt;code&gt;UTF-32&lt;/code&gt;等。&lt;/p&gt;
&lt;p&gt;某个字符的&lt;code&gt;Unicode&lt;/code&gt;通过查询标准得到，其&lt;code&gt;UTF-8&lt;/code&gt;编码由&lt;code&gt;Unicode&lt;/code&gt;码计算得到。&lt;/p&gt;
&lt;h3&gt;Python2中的str和unicode&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;str&lt;/code&gt;和&lt;code&gt;unicode&lt;/code&gt;是两个不同的类。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;str&lt;/code&gt;存储的是已经编码后的字节序列 …&lt;/p&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.python.org/2/howto/unicode.html"&gt;Python docs - Unicode HOWTO&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.python.org/2/library/stdtypes.html"&gt;Python docs - Built-in Types&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/2596714/why-does-python-print-unicode-characters-when-the-default-encoding-is-ascii"&gt;Stack Overflow - Why does Python print unicode characters when the default encoding is ASCII?&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;理论&lt;/h2&gt;
&lt;h3&gt;编码中的Unicode和UTF-8&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Unicode&lt;/code&gt;是字符集，&lt;code&gt;UTF-8&lt;/code&gt;是&lt;code&gt;Unicode&lt;/code&gt;的一种编码方式，并列的还包括&lt;code&gt;UTF-16&lt;/code&gt;、&lt;code&gt;UTF-32&lt;/code&gt;等。&lt;/p&gt;
&lt;p&gt;某个字符的&lt;code&gt;Unicode&lt;/code&gt;通过查询标准得到，其&lt;code&gt;UTF-8&lt;/code&gt;编码由&lt;code&gt;Unicode&lt;/code&gt;码计算得到。&lt;/p&gt;
&lt;h3&gt;Python2中的str和unicode&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;str&lt;/code&gt;和&lt;code&gt;unicode&lt;/code&gt;是两个不同的类。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;str&lt;/code&gt;存储的是已经编码后的字节序列，输出时看到每个字节用16进制表示，以&lt;code&gt;\x&lt;/code&gt;开头。每个汉字会占用3个字节的长度。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;啊哈哈&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;str&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe5\x95\x8a\xe5\x93\x88\xe5\x93\x88&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;9&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x8a&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;unicode&lt;/code&gt;是“字符”串，存储的是编码前的字符，输出是看到字符以&lt;code&gt;\u&lt;/code&gt;开头。每个汉字占用一个长度。定义一个&lt;code&gt;Unicode&lt;/code&gt;对象时，以&lt;code&gt;u&lt;/code&gt;
开头。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;哟呵呵&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;unicode&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u54df\u5475\u5475&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u5475&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;str&lt;/code&gt;可以通过&lt;code&gt;decode()&lt;/code&gt;方法转化为&lt;code&gt;unicode&lt;/code&gt;对象，参数指明编码方式。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u554a\u54c8\u54c8&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;unicode&lt;/code&gt;可以通过&lt;code&gt;encode()&lt;/code&gt;方法转化为&lt;code&gt;str&lt;/code&gt;对象，参数指明编码方式。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe5\x93\x9f\xe5\x91\xb5\xe5\x91\xb5&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;默认编码&lt;/h3&gt;
&lt;p&gt;Python2中的默认编码，有多个不同的变量。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;代码文件开头的&lt;code&gt;coding&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# -*- coding: utf-8 -*-
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;或&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# coding=utf-8
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;指明代码文件中的字符编码，用于代码文件中出现中文的情况。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;% cat hello.py&lt;/span&gt;
#! &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt; &lt;span class="n"&gt;python&lt;/span&gt;
# &lt;span class="n"&gt;coding&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="n"&gt;utf&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;
&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;泥壕&amp;#39;&lt;/span&gt;

&lt;span class="c"&gt;% python hello.py&lt;/span&gt;
泥壕
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果不设置，默认是&lt;code&gt;ascii&lt;/code&gt;，当出现中文字符时就不能正常识别。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;% cat hello.py&lt;/span&gt;
#! &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;env&lt;/span&gt; &lt;span class="n"&gt;python&lt;/span&gt;
&lt;span class="n"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;泥壕&amp;#39;&lt;/span&gt;

&lt;span class="c"&gt;% python hello.py&lt;/span&gt;
    &lt;span class="n"&gt;File&lt;/span&gt; &amp;quot;&lt;span class="n"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt;&amp;quot;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="n"&gt;SyntaxError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Non&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ASCII&lt;/span&gt; &lt;span class="n"&gt;character&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;\xe6&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;in&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="n"&gt;hello&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;py&lt;/span&gt; &lt;span class="n"&gt;on&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;but&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;encoding&lt;/span&gt; &lt;span class="n"&gt;declared&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;see&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;python&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;dev&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;peps&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;pep&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;0263&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;details&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;sys.stdin.encoding&lt;/code&gt;和&lt;code&gt;sys.stdout.encoding&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sdtin&lt;/code&gt;和&lt;code&gt;stdout&lt;/code&gt;输入输出使用的编码，包命令行参数和&lt;code&gt;print&lt;/code&gt;输出，由&lt;code&gt;locale&lt;/code&gt;环境变量决定。&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;en_US.UTF-8&lt;/code&gt;的系统中，默认值是&lt;code&gt;UTF-8&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;sys.getdefaultencoding()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;文件读写和字符串处理等操作使用的默认编码。&lt;/p&gt;
&lt;p&gt;默认值是&lt;code&gt;ascii&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;字符串拼接&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;unicode&lt;/code&gt;和&lt;code&gt;str&lt;/code&gt;类型通过&lt;code&gt;+&lt;/code&gt;拼接时，输出结果是&lt;code&gt;unicode&lt;/code&gt;类型，相当于先将&lt;code&gt;str&lt;/code&gt;类型的字符串通过&lt;code&gt;decode()&lt;/code&gt;方法解码成&lt;code&gt;unicode&lt;/code&gt;，再拼接。此时如果解码时没有明确指明编码类型，可能会出现错误。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;啊哈哈&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;哟呵呵&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;stdin&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="ne"&gt;UnicodeDecodeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;codec&lt;/span&gt; &lt;span class="n"&gt;can&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;t decode byte 0xe5 in position 0: ordinal not in range(128)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u554a\u54c8\u54c8\u54df\u5475\u5475&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;错误提到&lt;code&gt;'ascii' codec can't decode byte 0xe5&lt;/code&gt;，这是因为自动将&lt;code&gt;str&lt;/code&gt;类型的变量按照默认的编码格式&lt;code&gt;sys.getdefaultencoding()&lt;/code&gt;来解码，默认编码即&lt;code&gt;ascii&lt;/code&gt;，而这个字符不在&lt;code&gt;ascii&lt;/code&gt;的范围内，就出现了错误。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;reload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sys&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;built&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefaultencoding&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;啊哈哈&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;哟呵呵&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u554a\u54c8\u54c8\u54df\u5475\u5475&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;文件读取和json解析&lt;/h2&gt;
&lt;p&gt;读文件得到的结果是&lt;code&gt;str&lt;/code&gt;类型，以&lt;code&gt;\x&lt;/code&gt;开头的十六进制表示。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt; f = open(&amp;#39;t.txt&amp;#39;)
&amp;gt;&amp;gt;&amp;gt; a = f.read()
&amp;gt;&amp;gt;&amp;gt; a
&amp;#39;{&amp;quot;hello&amp;quot;:&amp;quot;\xe5\x92\xa9&amp;quot;}\n&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;而经过json解析后会自动转为&lt;code&gt;unicode&lt;/code&gt;。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt; json.loads(a)
{u&amp;#39;hello&amp;#39;: u&amp;#39;\u54a9&amp;#39;}
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;输出&lt;/h2&gt;
&lt;h3&gt;输出到文件&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;str&lt;/code&gt;类型可以输出到文件，而&lt;code&gt;unicode&lt;/code&gt;类型必须先编码成&lt;code&gt;str&lt;/code&gt;。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;啊哈哈&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;哟呵呵&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\xe5\x95\x8a\xe5\x93\x88\xe5\x93\x88&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u54df\u5475\u5475&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; 
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;t.txt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;stdin&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="ne"&gt;UnicodeEncodeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;codec&lt;/span&gt; &lt;span class="n"&gt;can&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;t encode characters in position 0-2: ordinal not in range(128)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;unicode&lt;/code&gt;输出到文件时的错误是由于默认编码为&lt;code&gt;ascii&lt;/code&gt;，无法自动完成编码过程。如果将&lt;code&gt;sys.getdefaultencoding()&lt;/code&gt;编码设置成了&lt;code&gt;utf-8&lt;/code&gt;就可以自动完成转换过程了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;reload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;sys&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;built&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefaultencoding&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;计算md5&lt;/h3&gt;
&lt;p&gt;同样，md5计算也要求输入的&lt;code&gt;unicode&lt;/code&gt;先编码。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;啊哈哈&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;哟呵呵&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;f38b302e2993ec3fdad79c4d76074b21&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;stdin&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="ne"&gt;UnicodeEncodeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;codec&lt;/span&gt; &lt;span class="n"&gt;can&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;t encode characters in position 0-2: ordinal not in range(128)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;c02dc06719bafeaf60505b11d3c0c90a&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;输出到stdout&lt;/h3&gt;
&lt;p&gt;输出到&lt;code&gt;stdout&lt;/code&gt;时，默认编码是&lt;code&gt;sys.stdout.encoding&lt;/code&gt;，默认值取决于系统环境变量，所以&lt;code&gt;print&lt;/code&gt;输出汉字时才可以不用指定&lt;code&gt;utf-8&lt;/code&gt;。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encoding&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u54a9&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="err"&gt;咩&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;而在&lt;code&gt;zh_CN.GB2312&lt;/code&gt;的环境中，默认值不是&lt;code&gt;utf-8&lt;/code&gt;，就不能正常输出了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encoding&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;ANSI_X3.4-1968&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u54a9&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="n"&gt;File&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;lt;stdin&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="ne"&gt;UnicodeEncodeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ascii&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;codec&lt;/span&gt; &lt;span class="n"&gt;can&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;t encode character u&amp;#39;&lt;/span&gt;\&lt;span class="n"&gt;u54a9&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; in position 0: ordinal not in range(128)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;命令行参数读取&lt;/h2&gt;
&lt;p&gt;通过&lt;code&gt;sys.argv&lt;/code&gt;或&lt;code&gt;argparse&lt;/code&gt;得到的命令行参数都是编码后的&lt;code&gt;str&lt;/code&gt;类型，以&lt;code&gt;\x&lt;/code&gt;开头的十六进制表示。可以通过&lt;code&gt;sys.stdin.encoding&lt;/code&gt;得到命令行传入的编码类型，解码成&lt;code&gt;unicode&lt;/code&gt;。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#! /usr/bin/env python&lt;/span&gt;
&lt;span class="c1"&gt;# coding = utf-8&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="nb"&gt;repr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encoding&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="nb"&gt;repr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;输出结果。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~/workspace % python hello.py &lt;span class="s2"&gt;&amp;quot;哇嘿嘿&amp;quot;&lt;/span&gt;  
&lt;span class="s1"&gt;&amp;#39;\xe5\x93\x87\xe5\x98\xbf\xe5\x98\xbf&amp;#39;&lt;/span&gt;
UTF-8
u&lt;span class="s1"&gt;&amp;#39;\u54c7\u563f\u563f&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如果命令行环境已经改成&lt;code&gt;GB2312&lt;/code&gt;等其他编码，python找不到与之匹配的编码类型，就会将默认编码&lt;code&gt;sys.stdin.encoding&lt;/code&gt;设置成&lt;code&gt;ascii&lt;/code&gt;，无法通过这种方法正常解码成&lt;code&gt;unicode&lt;/code&gt;。&lt;/p&gt;
&lt;h2&gt;带\u的字符串转unicode&lt;/h2&gt;
&lt;p&gt;可能会遇到汉字被转换成unicode编码的形式表示的情况，即一个汉字被表示成了&lt;code&gt;\u????&lt;/code&gt;的形式。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;咩&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u54a9&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\u54a9&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="s1"&gt;u54a9&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;上述&lt;code&gt;b&lt;/code&gt;就是这样的情况。此时&lt;code&gt;b&lt;/code&gt;是一个长度为6的字符串，而不是一个汉字。&lt;/p&gt;
&lt;p&gt;要把&lt;code&gt;b&lt;/code&gt;表示为汉字编码有两种方法。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;unicode-escape编码。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt; unicode(b, &amp;#39;unicode-escape&amp;#39;)
u&amp;#39;\u54a9&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;或&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt; b.decode(&amp;#39;unicode-escape&amp;#39;)
u&amp;#39;\u54a9&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;eval拼接。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt; eval(&amp;#39;u&amp;quot;&amp;#39; + b.replace(&amp;#39;&amp;quot;&amp;#39;, r&amp;#39;\&amp;quot;&amp;#39;)+&amp;#39;&amp;quot;&amp;#39;)
u&amp;#39;\u54a9&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ol&gt;</content><category term="Python"></category><category term="Python2"></category></entry><entry><title>Android设备上实现苹果IBeacon协议信号接收</title><link href="https://x7blog.info/archives/android_ibeacon_receive.html" rel="alternate"></link><published>2014-09-26T00:00:00+08:00</published><updated>2014-09-26T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2014-09-26:/archives/android_ibeacon_receive.html</id><summary type="html">&lt;h3&gt;背景资料&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/18906988/what-is-the-ibeacon-bluetooth-profile"&gt;这里&lt;/a&gt;详细介绍了iBeacon协议中的关键字段，此Demo根据协议中的字段，将蓝牙扫描到的记录字段做解析，判断记录是否是iBeacon包，并获得iBeacon中的信息字段，包括UUID，major，minor，txpower。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;02 # Number of bytes that follow in first AD structure&lt;/p&gt;
&lt;p&gt;01 # Flags AD type&lt;/p&gt;
&lt;p&gt;1A # Flags value 0x1A = 000011010&lt;/p&gt;
&lt;p&gt;bit 0 (OFF) LE Limited Discoverable Mode&lt;/p&gt;
&lt;p&gt;bit 1 (ON) LE General Discoverable Mode&lt;/p&gt;
&lt;p&gt;bit 2 (OFF) BR/EDR Not …&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;h3&gt;背景资料&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://stackoverflow.com/questions/18906988/what-is-the-ibeacon-bluetooth-profile"&gt;这里&lt;/a&gt;详细介绍了iBeacon协议中的关键字段，此Demo根据协议中的字段，将蓝牙扫描到的记录字段做解析，判断记录是否是iBeacon包，并获得iBeacon中的信息字段，包括UUID，major，minor，txpower。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;02 # Number of bytes that follow in first AD structure&lt;/p&gt;
&lt;p&gt;01 # Flags AD type&lt;/p&gt;
&lt;p&gt;1A # Flags value 0x1A = 000011010&lt;/p&gt;
&lt;p&gt;bit 0 (OFF) LE Limited Discoverable Mode&lt;/p&gt;
&lt;p&gt;bit 1 (ON) LE General Discoverable Mode&lt;/p&gt;
&lt;p&gt;bit 2 (OFF) BR/EDR Not Supported&lt;/p&gt;
&lt;p&gt;bit 3 (ON) Simultaneous LE and BR/EDR to Same Device Capable (controller)&lt;/p&gt;
&lt;p&gt;bit 4 (ON) Simultaneous LE and BR/EDR to Same Device Capable (Host)&lt;/p&gt;
&lt;p&gt;1A # Number of bytes that follow in second (and last) AD structure&lt;/p&gt;
&lt;p&gt;FF # Manufacturer specific data AD type&lt;/p&gt;
&lt;p&gt;4C 00 # Company identifier code (0x004C == Apple)&lt;/p&gt;
&lt;p&gt;02 # Byte 0 of iBeacon advertisement indicator&lt;/p&gt;
&lt;p&gt;15 # Byte 1 of iBeacon advertisement indicator&lt;/p&gt;
&lt;p&gt;e2 c5 6d b5 df fb 48 d2 b0 60 d0 f5 a7 10 96 e0 # iBeacon proximity uuid&lt;/p&gt;
&lt;p&gt;00 00 # major&lt;/p&gt;
&lt;p&gt;00 00 # minor&lt;/p&gt;
&lt;p&gt;c5 # The 2's complement of the calibrated Tx Power&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;关键实现步骤&lt;/h3&gt;
&lt;p&gt;通过&lt;code&gt;BluetoothAdapter&lt;/code&gt;启动低功耗蓝牙的扫描，指定LeScanCallBack作为参数处理接收到的记录，这部分操作在&lt;code&gt;IBeaconMonitorService.java&lt;/code&gt;中。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// start le scan&lt;/span&gt;
&lt;span class="kt"&gt;boolean&lt;/span&gt; &lt;span class="n"&gt;isScanStarted&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getBluetoothAdapter&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;startLeScan&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;leScanCallBack&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="n"&gt;BluetoothAdapter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;LeScanCallback&lt;/span&gt; &lt;span class="n"&gt;leScanCallBack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;BluetoothAdapter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;LeScanCallback&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nd"&gt;@Override&lt;/span&gt;
    &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;onLeScan&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BluetoothDevice&lt;/span&gt; &lt;span class="n"&gt;device&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;rssi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;scanRecord&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// 这里的scanRecord就是要处理的记录&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;处理接收到的记录，这是一个byte数组，根据协议规定判断是否是iBeacon包，再取出相应位置的字段获取信息，这部分代码在&lt;code&gt;IBeacon.java&lt;/code&gt;中，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;IBeacon&lt;/span&gt; &lt;span class="nf"&gt;readFromArray&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// see&lt;/span&gt;
    &lt;span class="c1"&gt;// http://stackoverflow.com/questions/18906988/what-is-the-ibeacon-bluetooth-profile&lt;/span&gt;
    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;v&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bytesToHexString&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(((&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xff&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xff&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mh"&gt;0x1502&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;d&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;this is not ibeacon !&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;d&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;find ibeacon !&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;

    &lt;span class="c1"&gt;// read uuid&lt;/span&gt;
    &lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;arrayUuid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="o"&gt;];&lt;/span&gt;
    &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;arraycopy&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;arrayUuid&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;uuid - &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bytesToHexString&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arrayUuid&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;uuid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;bytesToHexString&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arrayUuid&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;

    &lt;span class="c1"&gt;// read major&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;major&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xff&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xff&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;major - &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toHexString&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;major&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;

    &lt;span class="c1"&gt;// read minor&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;minor&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xff&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;28&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt; &lt;span class="mh"&gt;0xff&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;minor - &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toHexString&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;minor&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;

    &lt;span class="c1"&gt;// read txpower&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;txpower&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;src&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;29&lt;/span&gt;&lt;span class="o"&gt;];&lt;/span&gt;
    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;i&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;txpower - &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;txpower&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;用PC发送iBeacon信号做测试&lt;/h3&gt;
&lt;p&gt;启动蓝牙模块&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo hciconfig hci0 up
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;设置iBeacon广播内容，注意符合iBeacon协议中规定的字段&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo hcitool -i hci0 cmd 0x08 0x0008 1E &lt;span class="m"&gt;02&lt;/span&gt; &lt;span class="m"&gt;01&lt;/span&gt; 1A 1A FF 4C &lt;span class="m"&gt;00&lt;/span&gt; &lt;span class="m"&gt;02&lt;/span&gt; &lt;span class="m"&gt;15&lt;/span&gt; &lt;span class="m"&gt;00&lt;/span&gt; &lt;span class="m"&gt;11&lt;/span&gt; &lt;span class="m"&gt;22&lt;/span&gt; &lt;span class="m"&gt;33&lt;/span&gt; &lt;span class="m"&gt;44&lt;/span&gt; &lt;span class="m"&gt;55&lt;/span&gt; &lt;span class="m"&gt;66&lt;/span&gt; &lt;span class="m"&gt;77&lt;/span&gt; &lt;span class="m"&gt;88&lt;/span&gt; &lt;span class="m"&gt;99&lt;/span&gt; AA BB CC DD EE FF &lt;span class="m"&gt;00&lt;/span&gt; &lt;span class="m"&gt;01&lt;/span&gt; &lt;span class="m"&gt;00&lt;/span&gt; &lt;span class="m"&gt;02&lt;/span&gt; C5 &lt;span class="m"&gt;00&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;开始广播(LE advertise)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo hciconfig hci0 leadv
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;停止广播&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo hciconfig hci0 noleadv
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;另外&lt;/h3&gt;
&lt;p&gt;GitHub上&lt;a href="https://github.com/RadiusNetworks/android-ibeacon-service"&gt;有一个工程&lt;/a&gt;是一个公司专门在Android上做的iBeacon的移植，但是由于不明原因被删除的公开的代码，不过在&lt;a href="https://github.com/RadiusNetworks/android-ibeacon-service/tree/800a1d1b24e1d5f13f4589412ce5c6bf3f7bc3f1"&gt;其历史提交记录&lt;/a&gt;中还是可以看到删除前的代码，至于删除原因该公司没有说明，给出的咨询邮箱没有回复。&lt;/p&gt;</content><category term="Android"></category><category term="IBeacon"></category></entry><entry><title>Android声波通信</title><link href="https://x7blog.info/archives/android_voice_communication.html" rel="alternate"></link><published>2014-09-26T00:00:00+08:00</published><updated>2014-09-26T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2014-09-26:/archives/android_voice_communication.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/Katee/quietnet"&gt;Quietnet&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;发送部分&lt;/h3&gt;
&lt;p&gt;通过超声波(19.1kHz)携带信息，OOK调制，叠加一段音乐后发送。&lt;/p&gt;
&lt;h4&gt;编码&lt;/h4&gt;
&lt;p&gt;由于采用了较简单的OOK调制，所以要在调制前把目标信息编码成二进制。采用&lt;a href="https://github.com/Katee/quietnet"&gt;这个Python工程&lt;/a&gt;的编码。&lt;/p&gt;
&lt;p&gt;编码采用类似霍夫曼编码的思路，但是为了在接收时判断字符的开始结束，引入了对编码的限制。因为接收时通过两个连续的0判定一个自负的结束，所以要求编码首尾都是1，而且不出现连续的0。&lt;/p&gt;
&lt;h4&gt;调制&lt;/h4&gt;
&lt;p&gt;每个bit字符占用3个chunk，即重复3遍发送，这是为了在接收时方便判定同步，否则如果接收的采样区间跨越了0和1两个不同的比特，就会造成解调错误。&lt;/p&gt;
&lt;p&gt;采用OOK调制。1bit对应有声波，声波波形采用正弦波，与采样率相关，用如下方法计算数组的值；0bit对应没有声波。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;for (int j = 0; j &amp;lt; Constants.DATASIZE; j++) {
    tone[j] = Math.sin(2 * Math.PI * freq
        * ((double …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/Katee/quietnet"&gt;Quietnet&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;发送部分&lt;/h3&gt;
&lt;p&gt;通过超声波(19.1kHz)携带信息，OOK调制，叠加一段音乐后发送。&lt;/p&gt;
&lt;h4&gt;编码&lt;/h4&gt;
&lt;p&gt;由于采用了较简单的OOK调制，所以要在调制前把目标信息编码成二进制。采用&lt;a href="https://github.com/Katee/quietnet"&gt;这个Python工程&lt;/a&gt;的编码。&lt;/p&gt;
&lt;p&gt;编码采用类似霍夫曼编码的思路，但是为了在接收时判断字符的开始结束，引入了对编码的限制。因为接收时通过两个连续的0判定一个自负的结束，所以要求编码首尾都是1，而且不出现连续的0。&lt;/p&gt;
&lt;h4&gt;调制&lt;/h4&gt;
&lt;p&gt;每个bit字符占用3个chunk，即重复3遍发送，这是为了在接收时方便判定同步，否则如果接收的采样区间跨越了0和1两个不同的比特，就会造成解调错误。&lt;/p&gt;
&lt;p&gt;采用OOK调制。1bit对应有声波，声波波形采用正弦波，与采样率相关，用如下方法计算数组的值；0bit对应没有声波。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;for (int j = 0; j &amp;lt; Constants.DATASIZE; j++) {
    tone[j] = Math.sin(2 * Math.PI * freq
        * ((double) (j + offset) / Constants.RATE));
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;调制以后如果直接发送已经可以正常接收解调了，不过这样由于声音经常发生从0跳变到很大，手机发送时会出现杂音，所以做了一个平滑处理，这也是参考了&lt;a href="https://github.com/Katee/quietnet"&gt;这个Python工程&lt;/a&gt;，使音量平滑上升和下降，有效避免杂音。&lt;/p&gt;
&lt;h4&gt;叠加&lt;/h4&gt;
&lt;p&gt;为了让人耳直观的感受到当前有信息正在发送，所以在超声波之上叠加一段正常频率范围的音乐。经过查阅资料研究，19kHz的超声和正常频率之间不会发生担心的混频现象。&lt;/p&gt;
&lt;p&gt;叠加直接将两个声波的short数组按一定权值相加即可。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;background&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;background&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;short&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;background&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mf"&gt;0.8&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="o"&gt;]);&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;另外，携带信息的超声波信号可能会比背景声音更长，所以在这种情况下要扩展背景声音的长度。&lt;/p&gt;
&lt;h3&gt;接收部分&lt;/h3&gt;
&lt;h4&gt;解调&lt;/h4&gt;
&lt;p&gt;用FFT变换做解调。这是为了去除叠加的背景音乐和周围环境噪声的影响，否则在采样率相对于信号频率不太高的情况下，使用简单的过零检测误码率极大。&lt;/p&gt;
&lt;p&gt;由AudioRecord接收到的数组按chunk的大小分片，每一片单独处理。利用FFT变换，可以计算出每一片在19kHz频率的功率，如果超过一定阈值，判定当前是1bit，如果没有超过，则当前是0bit。&lt;/p&gt;
&lt;p&gt;FFT变换使用&lt;code&gt;org.apache.commons.math3.transform&lt;/code&gt;库，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;transformer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;FastFourierTransformer&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DftNormalization&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;STANDARD&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;Complex&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;fftResultComplex&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;transformer&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;transform&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dataComplex&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;TransformType&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;FORWARD&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;fftResultComplex&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;length&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;ret&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Math&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;round&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fftResultComplex&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;].&lt;/span&gt;&lt;span class="na"&gt;abs&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;符号同步问题：当在一直收到0时，认为当前还没有开始发送，一旦出现了一个超过阈值的分片，即开始发送信号，那么这个分片和后面的2个组成一个3个chunk大小的分组，他们代表的是一个bit，那么同步就完成了，再后边的分片就可以直接认为是三个一组进行判定了。&lt;/p&gt;
&lt;h4&gt;解码&lt;/h4&gt;
&lt;p&gt;解码器中保存解调器解调得到的bit流，因为采用了特殊的编码方式，接收时如果出现连续的0则认为是一个字符结束，就将之前的bit与码表中做对比，即可判定出发送方的字符。&lt;/p&gt;
&lt;h3&gt;发送和识别有效信息&lt;/h3&gt;
&lt;p&gt;信息发送是循环的，为了接收方判断接收到的字符串是否是完整的uid串，在发送时将uid首尾用&lt;code&gt;B&lt;/code&gt;、&lt;code&gt;E&lt;/code&gt;字符标明，当接收方接收到&lt;code&gt;B&lt;/code&gt;字符时才开始记录，当接收到&lt;code&gt;E&lt;/code&gt;时认为接收完毕，这时就可以取出中间的字符串认为是要传递的有效信息。&lt;/p&gt;</content><category term="Android"></category><category term="voice"></category></entry><entry><title>SQL中利用case语句根据多列排序</title><link href="https://x7blog.info/archives/mysql_sort_using_case.html" rel="alternate"></link><published>2014-05-29T00:00:00+08:00</published><updated>2014-05-29T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2014-05-29:/archives/mysql_sort_using_case.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="http://blog.csdn.net/chen_linbo/article/details/6396122"&gt;oracle union all和order by一起使用&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;需求是这样的，有类似如下的表，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;+--------+------+-----+-----+------+---------+----------+
| userid | imei | lat | lon | addr | network | operator |
+--------+------+-----+-----+------+---------+----------+
| 122    | 343  |     |     |      | 3G      | 12344    |
| 123    | 345  |     |     |      | Wi-Fi   | 12345    |
| 124    | 346  |     |     |      | Wi-Fi   | 12345    |
| 125    | 347  |     |     |      | 3G      | 12345    |
| 126    | 348  |     |     |      | 3G      | 12346    |
| 127    | 349  |     |     |      | 3G      | 12347    |
| 128    | 350  |     |     |      | 3G      | 12343    |
| 129    | 351  |     |     |      | 3G      | 12345    |
| 130    | 352  |     |     |      | 2G      | 12345 …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="http://blog.csdn.net/chen_linbo/article/details/6396122"&gt;oracle union all和order by一起使用&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;需求是这样的，有类似如下的表，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;+--------+------+-----+-----+------+---------+----------+
| userid | imei | lat | lon | addr | network | operator |
+--------+------+-----+-----+------+---------+----------+
| 122    | 343  |     |     |      | 3G      | 12344    |
| 123    | 345  |     |     |      | Wi-Fi   | 12345    |
| 124    | 346  |     |     |      | Wi-Fi   | 12345    |
| 125    | 347  |     |     |      | 3G      | 12345    |
| 126    | 348  |     |     |      | 3G      | 12346    |
| 127    | 349  |     |     |      | 3G      | 12347    |
| 128    | 350  |     |     |      | 3G      | 12343    |
| 129    | 351  |     |     |      | 3G      | 12345    |
| 130    | 352  |     |     |      | 2G      | 12345    |
| 131    | 353  |     |     |      | 4G      | 12345    |
| 133    | 354  |     |     |      | Wi-Fi   | 12346    |
+--------+------+-----+-----+------+---------+----------+
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;要对这个表排序输出，想要'network'为'Wi-Fi'的行在后，非'Wi-Fi'的行在前，而且两部分内分别按'operator'排序。也就是要得到如下的结果，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;+--------+------+-----+-----+------+---------+----------+
| userid | imei | lat | lon | addr | network | operator |
+--------+------+-----+-----+------+---------+----------+
| 128    | 350  |     |     |      | 3G      | 12343    |
| 122    | 343  |     |     |      | 3G      | 12344    |
| 131    | 353  |     |     |      | 4G      | 12345    |
| 125    | 347  |     |     |      | 3G      | 12345    |
| 129    | 351  |     |     |      | 3G      | 12345    |
| 130    | 352  |     |     |      | 2G      | 12345    |
| 126    | 348  |     |     |      | 3G      | 12346    |
| 127    | 349  |     |     |      | 3G      | 12347    |
| 124    | 346  |     |     |      | Wi-Fi   | 12345    |
| 123    | 345  |     |     |      | Wi-Fi   | 12345    |
| 133    | 354  |     |     |      | Wi-Fi   | 12346    |
+--------+------+-----+-----+------+---------+----------+
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;利用union语句&lt;/h3&gt;
&lt;p&gt;容易想到&lt;code&gt;select&lt;/code&gt;出'Wi-Fi'和非'Wi-Fi'两组结果，再用&lt;code&gt;union&lt;/code&gt;将两组结果拼在一起。但是这两组结果还需要分别按'operator'排序，所以尝试这样，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="n"&gt;push_user_list&lt;/span&gt;
&lt;span class="k"&gt;where&lt;/span&gt; &lt;span class="n"&gt;network&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Wi-Fi&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;order&lt;/span&gt; &lt;span class="k"&gt;by&lt;/span&gt; &lt;span class="k"&gt;operator&lt;/span&gt;
&lt;span class="k"&gt;union&lt;/span&gt;
&lt;span class="k"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="n"&gt;push_user_list&lt;/span&gt;
&lt;span class="k"&gt;order&lt;/span&gt; &lt;span class="k"&gt;by&lt;/span&gt; &lt;span class="k"&gt;operator&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但是&lt;code&gt;union&lt;/code&gt;的子句是不能用&lt;code&gt;order by&lt;/code&gt;的，报错，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ERROR 1221 (HY000): Incorrect usage of UNION and ORDER BY
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;搜了一下，有人给出这样的方法，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; 
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="n"&gt;push_user_list&lt;/span&gt; &lt;span class="k"&gt;where&lt;/span&gt; &lt;span class="n"&gt;network&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Wi-Fi&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;order&lt;/span&gt; &lt;span class="k"&gt;by&lt;/span&gt; &lt;span class="k"&gt;operator&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="k"&gt;desc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;t1&lt;/span&gt;
&lt;span class="k"&gt;union&lt;/span&gt;
&lt;span class="k"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="n"&gt;push_user_list&lt;/span&gt; &lt;span class="k"&gt;where&lt;/span&gt; &lt;span class="n"&gt;network&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Wi-Fi&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;order&lt;/span&gt; &lt;span class="k"&gt;by&lt;/span&gt; &lt;span class="k"&gt;operator&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;t2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;看起来确实是个好主意，虽然据说在&lt;code&gt;Oracle SQL&lt;/code&gt;测试可以通过，但是在我用的&lt;code&gt;MariaDB 5.5.37-1&lt;/code&gt;结果排序却是错的，'operator'列并没有排序，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;+--------+------+-----+-----+------+---------+----------+
| userid | imei | lat | lon | addr | network | operator |
+--------+------+-----+-----+------+---------+----------+
| 122    | 343  |     |     |      | 3G      | 12344    |
| 125    | 347  |     |     |      | 3G      | 12345    |
| 126    | 348  |     |     |      | 3G      | 12346    |
| 127    | 349  |     |     |      | 3G      | 12347    |
| 128    | 350  |     |     |      | 3G      | 12343    |
| 129    | 351  |     |     |      | 3G      | 12345    |
| 130    | 352  |     |     |      | 2G      | 12345    |
| 131    | 353  |     |     |      | 4G      | 12345    |
| 123    | 345  |     |     |      | Wi-Fi   | 12345    |
| 124    | 346  |     |     |      | Wi-Fi   | 12345    |
| 133    | 354  |     |     |      | Wi-Fi   | 12346    |
+--------+------+-----+-----+------+---------+----------+
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;利用case语句&lt;/h3&gt;
&lt;p&gt;从另一种思路考虑，放弃&lt;code&gt;union&lt;/code&gt;的用法，把变量值用&lt;code&gt;case&lt;/code&gt;或者&lt;code&gt;decode&lt;/code&gt;表示，如果'network'是'Wi-Fi'就让排序的变量值为'~'，与'operator'列一起排序，这样就可以正常使用&lt;code&gt;order by&lt;/code&gt;使'Wi-Fi'的行排在最后了，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;select&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="n"&gt;push_user_list&lt;/span&gt;
&lt;span class="k"&gt;order&lt;/span&gt; &lt;span class="k"&gt;by&lt;/span&gt;
&lt;span class="k"&gt;case&lt;/span&gt;
&lt;span class="k"&gt;when&lt;/span&gt; &lt;span class="n"&gt;network&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Wi-Fi&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;~&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;operator&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="n"&gt;network&lt;/span&gt; &lt;span class="k"&gt;desc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样的结果就很完美了，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;+--------+------+-----+-----+------+---------+----------+
| userid | imei | lat | lon | addr | network | operator |
+--------+------+-----+-----+------+---------+----------+
| 128    | 350  |     |     |      | 3G      | 12343    |
| 122    | 343  |     |     |      | 3G      | 12344    |
| 131    | 353  |     |     |      | 4G      | 12345    |
| 125    | 347  |     |     |      | 3G      | 12345    |
| 129    | 351  |     |     |      | 3G      | 12345    |
| 130    | 352  |     |     |      | 2G      | 12345    |
| 126    | 348  |     |     |      | 3G      | 12346    |
| 127    | 349  |     |     |      | 3G      | 12347    |
| 124    | 346  |     |     |      | Wi-Fi   | 12345    |
| 123    | 345  |     |     |      | Wi-Fi   | 12345    |
| 133    | 354  |     |     |      | Wi-Fi   | 12346    |
+--------+------+-----+-----+------+---------+----------+
&lt;/pre&gt;&lt;/div&gt;</content><category term="SQL"></category></entry><entry><title>Linux系统中LaTeX的安装与使用</title><link href="https://x7blog.info/archives/latex_on_linux.html" rel="alternate"></link><published>2014-03-17T00:00:00+08:00</published><updated>2014-03-17T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2014-03-17:/archives/latex_on_linux.html</id><summary type="html">&lt;h3&gt;安装&lt;/h3&gt;
&lt;p&gt;针对Archlinux，需要&lt;a href="https://wiki.archlinux.org/index.php/TeX_Live"&gt;TeX Live&lt;/a&gt;，首先要编译LaTeX文件需要这个包&lt;code&gt;texlive-bin&lt;/code&gt;，有一些图片字体之类的依赖，在这一组包里&lt;code&gt;texlive-most&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果想用vim或者emacs编辑LaTeX文件的话，就不需要专门的编辑器了。&lt;/p&gt;
&lt;p&gt;Linux下的LaTeX编辑器&lt;a href="https://wiki.archlinux.org/index.php/Latex"&gt;有很多&lt;/a&gt;，我使用的是&lt;code&gt;Kile&lt;/code&gt;，KDE的组件，在Gnome和xfce下也可以正常使用，虽然不能像retext编辑Markdown那样实时预览，不过比起vim需要配置一堆插件来说还是很方便的。&lt;/p&gt;
&lt;h3&gt;使用&lt;/h3&gt;
&lt;p&gt;LaTeX文件后缀通常为&lt;code&gt;.tex&lt;/code&gt;。可以在命令行直接编译，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;latex source.tex
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;用&lt;code&gt;Kile&lt;/code&gt;编辑文件，可以直接通过''QuickBuild''编译生成pdf并直接打开预览。&lt;/p&gt;
&lt;h4&gt;Helloworld&lt;/h4&gt;
&lt;p&gt;简单测试代码，很容易理解，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\documentclass&lt;/span&gt;&lt;span class="na"&gt;[11pt]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;article&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;cite&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;document&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;\title&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;My Article&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\author&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;Nobody Jr.&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\date&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;Today&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\maketitle …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h3&gt;安装&lt;/h3&gt;
&lt;p&gt;针对Archlinux，需要&lt;a href="https://wiki.archlinux.org/index.php/TeX_Live"&gt;TeX Live&lt;/a&gt;，首先要编译LaTeX文件需要这个包&lt;code&gt;texlive-bin&lt;/code&gt;，有一些图片字体之类的依赖，在这一组包里&lt;code&gt;texlive-most&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果想用vim或者emacs编辑LaTeX文件的话，就不需要专门的编辑器了。&lt;/p&gt;
&lt;p&gt;Linux下的LaTeX编辑器&lt;a href="https://wiki.archlinux.org/index.php/Latex"&gt;有很多&lt;/a&gt;，我使用的是&lt;code&gt;Kile&lt;/code&gt;，KDE的组件，在Gnome和xfce下也可以正常使用，虽然不能像retext编辑Markdown那样实时预览，不过比起vim需要配置一堆插件来说还是很方便的。&lt;/p&gt;
&lt;h3&gt;使用&lt;/h3&gt;
&lt;p&gt;LaTeX文件后缀通常为&lt;code&gt;.tex&lt;/code&gt;。可以在命令行直接编译，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;latex source.tex
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;用&lt;code&gt;Kile&lt;/code&gt;编辑文件，可以直接通过''QuickBuild''编译生成pdf并直接打开预览。&lt;/p&gt;
&lt;h4&gt;Helloworld&lt;/h4&gt;
&lt;p&gt;简单测试代码，很容易理解，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\documentclass&lt;/span&gt;&lt;span class="na"&gt;[11pt]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;article&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;cite&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;document&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;\title&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;My Article&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\author&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;Nobody Jr.&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\date&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;Today&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\maketitle&lt;/span&gt;

Blablabla said Nobody ~&lt;span class="k"&gt;\cite&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;Nobody06&lt;span class="nb"&gt;}&lt;/span&gt;.

&lt;span class="k"&gt;\bibliographystyle&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;IEEEtran&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\bibliography&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;mybib&lt;span class="nb"&gt;}{}&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;document&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;生成的pdf是这样的，&lt;/p&gt;
&lt;p&gt;&lt;img alt="Hello world 的编译结果" src="/images/latex_on_linux-00.png"&gt;&lt;/p&gt;
&lt;h4&gt;使用模板&lt;/h4&gt;
&lt;p&gt;虽然语法不是太难理解，但是要自己编辑一篇文章符合投稿的各种格式需求还是相当困难的，所以要套用模板，比如&lt;a href="http://www.ieee.org/conferences_events/conferences/publishing/templates.html"&gt;这里&lt;/a&gt;可以下载IEEE的模板，包括四个tex文件，bare_conf是会议，bare_jrnl和bare_jrnl_compsoc一个是for Computer Society Journals一个是for journals，bare_adv是Bare Advanced Demo of IEEEtran.cls for Computer Society Journals。&lt;/p&gt;
&lt;h4&gt;插入图片&lt;/h4&gt;
&lt;p&gt;首先发表的论文中需要使用eps格式的图片的文件。matlab可以直接保存为eps格式。如果是visio图，需要先保存为pdf，再在acrobat中选择tools-&amp;gt;print production-&amp;gt;set page boxes-&amp;gt;勾选remove white margins-&amp;gt;OK，然后再保存为eps格式。&lt;/p&gt;
&lt;p&gt;根据IEEE提供的模板，插入图片很简单，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;graphicx&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figure&lt;span class="nb"&gt;}&lt;/span&gt;[!t]
&lt;span class="k"&gt;\centering&lt;/span&gt;
&lt;span class="k"&gt;\includegraphics&lt;/span&gt;&lt;span class="na"&gt;[width=2.5in]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;myfigure&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="c"&gt;% where an .eps filename suffix will be assumed under latex, &lt;/span&gt;
&lt;span class="c"&gt;% and a .pdf suffix will be assumed for pdflatex; or what has been declared&lt;/span&gt;
&lt;span class="c"&gt;% via \DeclareGraphicsExtensions.&lt;/span&gt;
&lt;span class="k"&gt;\caption&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;Simulation Results&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig&lt;span class="nb"&gt;_&lt;/span&gt;sim&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figure&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中，&lt;code&gt;\begin{figure}[!t]&lt;/code&gt;，&lt;code&gt;figure&lt;/code&gt;后可以加&lt;code&gt;*&lt;/code&gt;表示图片跨栏，&lt;code&gt;t&lt;/code&gt;参数表示图片的位置，&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;h: 直接放在目前所处位置&lt;/li&gt;
&lt;li&gt;t:  top，置顶&lt;/li&gt;
&lt;li&gt;b: bottom，置底&lt;/li&gt;
&lt;li&gt;p: 插入空白页之后h&lt;/li&gt;
&lt;li&gt;!: 让latex决定&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果要插入多张并列的一组图片，模板中提供了&lt;code&gt;subfloat&lt;/code&gt;的方法，不过似乎给出的语法有误。可以用下边的方法实现，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figure*&lt;span class="nb"&gt;}&lt;/span&gt;[!t]
&lt;span class="k"&gt;\centering&lt;/span&gt;
&lt;span class="k"&gt;\subfigure&lt;/span&gt;&lt;span class="na"&gt;[]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\includegraphics&lt;/span&gt;&lt;span class="na"&gt;[width=1.5in]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig2a.eps&lt;span class="nb"&gt;}&lt;/span&gt;&lt;span class="k"&gt;\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig&lt;span class="nb"&gt;_&lt;/span&gt;moreuser&lt;span class="nb"&gt;_&lt;/span&gt;a&lt;span class="nb"&gt;}}&lt;/span&gt;
&lt;span class="k"&gt;\hfil&lt;/span&gt;
&lt;span class="k"&gt;\subfigure&lt;/span&gt;&lt;span class="na"&gt;[]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\includegraphics&lt;/span&gt;&lt;span class="na"&gt;[width=1.5in]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig2b.eps&lt;span class="nb"&gt;}&lt;/span&gt;&lt;span class="k"&gt;\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig&lt;span class="nb"&gt;_&lt;/span&gt;moreuser&lt;span class="nb"&gt;_&lt;/span&gt;b&lt;span class="nb"&gt;}}&lt;/span&gt;
&lt;span class="k"&gt;\hfil&lt;/span&gt;
&lt;span class="k"&gt;\subfigure&lt;/span&gt;&lt;span class="na"&gt;[]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\includegraphics&lt;/span&gt;&lt;span class="na"&gt;[width=1.5in]&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig2c.eps&lt;span class="nb"&gt;}&lt;/span&gt;&lt;span class="k"&gt;\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig&lt;span class="nb"&gt;_&lt;/span&gt;moreuser&lt;span class="nb"&gt;_&lt;/span&gt;c&lt;span class="nb"&gt;}}&lt;/span&gt;
&lt;span class="k"&gt;\caption&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;More users can achieve more effective network utilization in 3G/4G network&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;fig&lt;span class="nb"&gt;_&lt;/span&gt;moreuser&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;figure*&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;插入表格&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;table&lt;span class="nb"&gt;}&lt;/span&gt;[!t]
&lt;span class="c"&gt;% increase table row spacing, adjust to taste&lt;/span&gt;
&lt;span class="k"&gt;\renewcommand&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;&lt;span class="k"&gt;\arraystretch&lt;/span&gt;&lt;span class="nb"&gt;}{&lt;/span&gt;1.3&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="c"&gt;% if using array.sty, it might be a good idea to tweak the value of&lt;/span&gt;
&lt;span class="c"&gt;% \extrarowheight as needed to properly center the text within the cells&lt;/span&gt;
&lt;span class="k"&gt;\caption&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;An Example of a Table&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;table&lt;span class="nb"&gt;_&lt;/span&gt;example&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\centering&lt;/span&gt;
&lt;span class="c"&gt;% Some packages, such as MDW tools, offer better commands for making tables&lt;/span&gt;
&lt;span class="c"&gt;% than the plain LaTeX2e tabular which is used here.&lt;/span&gt;
&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;tabular&lt;span class="nb"&gt;}{&lt;/span&gt;|c|c|&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\hline&lt;/span&gt;
One &lt;span class="nb"&gt;&amp;amp;&lt;/span&gt; Two&lt;span class="k"&gt;\\&lt;/span&gt;
&lt;span class="k"&gt;\hline&lt;/span&gt;
Three &lt;span class="nb"&gt;&amp;amp;&lt;/span&gt; Four&lt;span class="k"&gt;\\&lt;/span&gt;
&lt;span class="k"&gt;\hline&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;tabular&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;table&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="插入表格" src="/images/latex_on_linux-01.png"&gt;&lt;/p&gt;
&lt;h4&gt;插入算法&lt;/h4&gt;
&lt;p&gt;算法不是用表格填写的，而是有专门的语法，很方便，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;algorithmic&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\usepackage&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;algorithm&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;algorithm&lt;span class="nb"&gt;}&lt;/span&gt;[!t]
&lt;span class="k"&gt;\caption&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;Hello&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\label&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;alg&lt;span class="nb"&gt;_&lt;/span&gt;hello&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;algorithmic&lt;span class="nb"&gt;}&lt;/span&gt;[1]
&lt;span class="k"&gt;\WHILE&lt;/span&gt; &lt;span class="nb"&gt;{&lt;/span&gt;while&lt;span class="nb"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;\STATE&lt;/span&gt; state;&lt;span class="k"&gt;\&lt;/span&gt;
    &lt;span class="k"&gt;\IF&lt;/span&gt; &lt;span class="nb"&gt;{&lt;/span&gt;if&lt;span class="nb"&gt;}&lt;/span&gt;
        &lt;span class="k"&gt;\STATE&lt;/span&gt; state;&lt;span class="k"&gt;\&lt;/span&gt;
    &lt;span class="k"&gt;\ENDIF&lt;/span&gt;
&lt;span class="k"&gt;\ENDWHILE&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;algorithmic&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;algorithm&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="插入算法" src="/images/latex_on_linux-02.png"&gt;&lt;/p&gt;
&lt;h4&gt;插入参考文献&lt;/h4&gt;
&lt;p&gt;有两种方式。&lt;/p&gt;
&lt;h5&gt;thebibliography&lt;/h5&gt;
&lt;p&gt;参考模板中给出的格式，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\begin&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;thebibliography&lt;span class="nb"&gt;}{&lt;/span&gt;1&lt;span class="nb"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;\bibitem&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;IEEEhowto:kopka&lt;span class="nb"&gt;}&lt;/span&gt;
H.~Kopka and P.~W. Daly, &lt;span class="k"&gt;\emph&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;A Guide to &lt;span class="k"&gt;\LaTeX&lt;/span&gt;&lt;span class="nb"&gt;}&lt;/span&gt;, 3rd~ed.&lt;span class="k"&gt;\hskip&lt;/span&gt; 1em plus
  0.5em minus 0.4em&lt;span class="k"&gt;\relax&lt;/span&gt; Harlow, England: Addison-Wesley, 1999.

&lt;span class="k"&gt;\end&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;thebibliography&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;bibtex&lt;/h5&gt;
&lt;p&gt;正文中这样声明文件名，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;\bibliographystyle&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;IEEEtran&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;span class="k"&gt;\bibliography&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;IEEEabrv,mybib&lt;span class="nb"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;创建&lt;code&gt;mybib.bib&lt;/code&gt;文件，格式是这个样子的，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nc"&gt;@misc&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nl"&gt;Nobody06&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="na"&gt;author&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Nobody Jr&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="na"&gt;title&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;My Article&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="na"&gt;year&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;2006&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以在google scholar中生成bibtex的文件格式，cite-&amp;gt;import into bibtex&lt;/p&gt;
&lt;h4&gt;IEEE模板的段间距问题&lt;/h4&gt;
&lt;p&gt;在&lt;a href="http://www.ieee.org/conferences_events/conferences/publishing/templates.html"&gt;上述地址&lt;/a&gt;下载到的模板显示是&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;%% IEEEtran.cls 2011/11/03 version V1.8 based on&lt;/p&gt;
&lt;p&gt;%% IEEEtran.cls 2007/03/05 version V1.7a&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这个版本的conf模板生成的pdf文件会有较大的段落间距，但是注意到现在可以检索到的IEEE的文章多数都是没有段间距的。&lt;a href="http://blog.sciencenet.cn/blog-264887-725786.html"&gt;有人&lt;/a&gt;提到可以用另一个版本的模板代替官网上下载的版本，但是尝试后可以发现这个版本与官方版本的页边距等参数是不同的，为了避免其他问题，下面给出了避免段间距的办法。&lt;/p&gt;
&lt;p&gt;避免分段，当需要分段时，用&lt;code&gt;\\&lt;/code&gt;换行，再在下一行行首缩进固定的长度即可。&lt;/p&gt;
&lt;p&gt;本来的分段的写法，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;This demo file is intended to serve as a ``starter file&amp;#39;&amp;#39;
for IEEE conference papers produced under &lt;span class="k"&gt;\LaTeX\ &lt;/span&gt;using
IEEEtran.cls version 1.7 and later.

I wish you the best of success.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="有段间距" src="/images/latex_on_linux-03.png"&gt;&lt;/p&gt;
&lt;p&gt;用换行和缩进避免段间距，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;This demo file is intended to serve as a ``starter file&amp;#39;&amp;#39;
for IEEE conference papers produced under &lt;span class="k"&gt;\LaTeX\ &lt;/span&gt;using
IEEEtran.cls version 1.7 and later.&lt;span class="k"&gt;\\&lt;/span&gt;
&lt;span class="k"&gt;\hspace*&lt;/span&gt;&lt;span class="nb"&gt;{&lt;/span&gt;0.5cm&lt;span class="nb"&gt;}&lt;/span&gt;I wish you the best of success.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;img alt="避免段间距" src="/images/latex_on_linux-04.png"&gt;&lt;/p&gt;</content><category term="LaTeX"></category><category term="Linux"></category></entry><entry><title>用Pelican构建博客上传到Github Pages出错</title><link href="https://x7blog.info/archives/page_build_failed.html" rel="alternate"></link><published>2013-12-04T00:00:00+08:00</published><updated>2013-12-04T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-12-04:/archives/page_build_failed.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://help.github.com/articles/using-submodules-with-pages"&gt;Using submodules with Pages&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;出错情况&lt;/h3&gt;
&lt;p&gt;上次写完博客，上传Github的时候突然出问题了，现在当然已经修复。&lt;/p&gt;
&lt;p&gt;用&lt;code&gt;pelican&lt;/code&gt;和&lt;code&gt;markdown&lt;/code&gt;本地编译成功，但是用&lt;code&gt;git&lt;/code&gt;提交到&lt;code&gt;Github&lt;/code&gt;时，收到了这么一封邮件，&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;From:  GitHub (noreply@github.com) This sender is in your safe list.&lt;/p&gt;
&lt;p&gt;Sent:  Saturday, November 30, 2013 1:06:57 PM&lt;/p&gt;
&lt;p&gt;To:    x7hub (x7.0@outlook.com)&lt;/p&gt;
&lt;p&gt;The page build …&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://help.github.com/articles/using-submodules-with-pages"&gt;Using submodules with Pages&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;出错情况&lt;/h3&gt;
&lt;p&gt;上次写完博客，上传Github的时候突然出问题了，现在当然已经修复。&lt;/p&gt;
&lt;p&gt;用&lt;code&gt;pelican&lt;/code&gt;和&lt;code&gt;markdown&lt;/code&gt;本地编译成功，但是用&lt;code&gt;git&lt;/code&gt;提交到&lt;code&gt;Github&lt;/code&gt;时，收到了这么一封邮件，&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;From:  GitHub (noreply@github.com) This sender is in your safe list.&lt;/p&gt;
&lt;p&gt;Sent:  Saturday, November 30, 2013 1:06:57 PM&lt;/p&gt;
&lt;p&gt;To:    x7hub (x7.0@outlook.com)&lt;/p&gt;
&lt;p&gt;The page build failed with the following error:&lt;/p&gt;
&lt;p&gt;page build failed&lt;/p&gt;
&lt;p&gt;For information on troubleshooting Jekyll see:&lt;/p&gt;
&lt;p&gt;https://help.github.com/articles/using-jekyll-with-pages#troubleshooting&lt;/p&gt;
&lt;p&gt;If you have any questions please contact us at https://github.com/contact.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;错误信息就只有&lt;code&gt;page build failed&lt;/code&gt;，给出的帮助链接指向的是&lt;code&gt;Jekyll&lt;/code&gt;，我用的是&lt;code&gt;Pelican&lt;/code&gt;啊，很苦恼啊。于是尝试了删除新添加的博文，尝试了回退到之前的版本，尝试更新系统软件，都不起作用，每次提交都会收到上面那封邮件。无奈之下求助邮件中的第二个链接，就是&lt;a href="https://github.com/contact"&gt;Github的帮助&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;求助Github&lt;/h3&gt;
&lt;p&gt;帮助页面写着，&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We’re here to help with any questions or comments. If you just want to say hi, that's cool too.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;简单说明了问题以后，几分钟内就收到了答复邮件，&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Sorry about this. We are currently working on improving these error messages.&lt;/p&gt;
&lt;p&gt;The actual error found in the page build logs is as follows:&lt;/p&gt;
&lt;p&gt;No submodule mapping found in .gitmodules for path 'pelican-plugins'&lt;/p&gt;
&lt;p&gt;Please take a look at our Help article on using Git submodules with GitHub Pages:&lt;/p&gt;
&lt;p&gt;https://help.github.com/articles/using-submodules-with-pages&lt;/p&gt;
&lt;p&gt;That should help you sort out the issue.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;No submodule mapping found in .gitmodules for path 'pelican-plugins'&lt;/code&gt;这个就是问题所在了。因为我的博客目录下有&lt;code&gt;pelican-plugins&lt;/code&gt;和&lt;code&gt;pelican-themes&lt;/code&gt;两个submodule，之前也没有在&lt;code&gt;.gitmodules&lt;/code&gt;中声明，现在他们不认了。&lt;/p&gt;
&lt;p&gt;自己也不会写&lt;code&gt;.gitmodules&lt;/code&gt;，所以还是交给&lt;code&gt;git&lt;/code&gt;自动添加吧，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;rm -rf pelican-plugins
rm -rf pelican-themes
ga . -A
gc -m &lt;span class="s2"&gt;&amp;quot;remove 2 submodule dirs &amp;quot;&lt;/span&gt;
git submodule add  https://github.com/getpelican/pelican-plugins pelican-plugins
git submodule add  https://github.com/getpelican/pelican-themes pelican-themes
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;现在&lt;code&gt;.gitmodules&lt;/code&gt;是这样的了，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[submodule &amp;quot;pelican-plugins&amp;quot;]&lt;/span&gt;
    &lt;span class="na"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;pelican-plugins&lt;/span&gt;
&lt;span class="s"&gt;    url = https://github.com/getpelican/pelican-plugins&lt;/span&gt;
&lt;span class="k"&gt;[submodule &amp;quot;pelican-themes&amp;quot;]&lt;/span&gt;
    &lt;span class="na"&gt;path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;pelican-themes&lt;/span&gt;
&lt;span class="s"&gt;    url = https://github.com/getpelican/pelican-themes&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;再次提交，没有收到报错的邮件，很快就在页面上看到更新了。&lt;/p&gt;</content><category term="GitHub"></category><category term="Pelican"></category></entry><entry><title>对比zsh和bash中的数组与关联数组</title><link href="https://x7blog.info/archives/zsh_array.html" rel="alternate"></link><published>2013-11-30T00:00:00+08:00</published><updated>2013-11-30T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-11-30:/archives/zsh_array.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;Linux Shell脚本攻略 人民邮电出版社&lt;/p&gt;
&lt;h3&gt;数组&lt;/h3&gt;
&lt;p&gt;可以这样定义数组，在&lt;code&gt;bash&lt;/code&gt;和&lt;code&gt;zsh&lt;/code&gt;都可以，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但是，读数组的时候有区别，在&lt;code&gt;bash&lt;/code&gt;中，数组索引以&lt;code&gt;0&lt;/code&gt;开始，符合一般习惯，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[0]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但是，在&lt;code&gt;zsh …&lt;/code&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;Linux Shell脚本攻略 人民邮电出版社&lt;/p&gt;
&lt;h3&gt;数组&lt;/h3&gt;
&lt;p&gt;可以这样定义数组，在&lt;code&gt;bash&lt;/code&gt;和&lt;code&gt;zsh&lt;/code&gt;都可以，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但是，读数组的时候有区别，在&lt;code&gt;bash&lt;/code&gt;中，数组索引以&lt;code&gt;0&lt;/code&gt;开始，符合一般习惯，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[0]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但是，在&lt;code&gt;zsh&lt;/code&gt;中，数组索引以&lt;code&gt;1&lt;/code&gt;开始，索引&lt;code&gt;0&lt;/code&gt;是空的，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~/workspace/shell % &lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[0]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;

~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[1]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;1&lt;/span&gt;
~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[2]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;2&lt;/span&gt;
~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[6]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;6&lt;/span&gt;
~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[7]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; 

~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;6&lt;/span&gt;
~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[*]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; 
&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;6&lt;/span&gt;
~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[@]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; 
&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="m"&gt;4&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;6&lt;/span&gt;
~/workspace/shell % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${#&lt;/span&gt;&lt;span class="nv"&gt;array_var&lt;/span&gt;&lt;span class="p"&gt;[*]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="m"&gt;6&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;关联数组&lt;/h3&gt;
&lt;p&gt;在&lt;code&gt;bash&lt;/code&gt;中，可以这样声明关联数组，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;declare&lt;/span&gt; -A ass_array
&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nv"&gt;ass_array&lt;/span&gt;&lt;span class="o"&gt;=([&lt;/span&gt;index1&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;val1&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;index2&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;val2&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但是在&lt;code&gt;zsh&lt;/code&gt;中就不行，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~ % &lt;span class="nb"&gt;declare&lt;/span&gt; -A ass_array 
~ % &lt;span class="nv"&gt;ass_array&lt;/span&gt;&lt;span class="o"&gt;=([&lt;/span&gt;index1&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;val1&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;index2&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;val2&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
zsh: no matches found: &lt;span class="o"&gt;[&lt;/span&gt;index1&lt;span class="o"&gt;]=&lt;/span&gt;val1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;只能这样才行，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~ % &lt;span class="nb"&gt;declare&lt;/span&gt; -A ass_array
~ % ass_array&lt;span class="o"&gt;[&lt;/span&gt;index1&lt;span class="o"&gt;]=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;val1&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;另外，在&lt;code&gt;bash&lt;/code&gt;访问数组需要加大括号，不加的话拿到的是奇怪的东西，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;ass_array&lt;/span&gt;&lt;span class="p"&gt;[index1]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
val1
&lt;span class="o"&gt;[&lt;/span&gt;x7@localhost ~&lt;span class="o"&gt;]&lt;/span&gt;$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$ass_array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;index1&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt;index1&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在&lt;code&gt;zsh&lt;/code&gt;中就可以不用大括号直接拿，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~ % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;ass_array&lt;/span&gt;&lt;span class="p"&gt;[index1]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
val1
~ % &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$ass_array&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;index1&lt;span class="o"&gt;]&lt;/span&gt;
val1
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;暂时就这些&lt;/h3&gt;
&lt;p&gt;看来zsh和bash有好多不同啊，以前都没在意过。。。&lt;/p&gt;</content><category term="Linux"></category><category term="shell"></category></entry><entry><title>对Service中弹出的Dialog设置主题</title><link href="https://x7blog.info/archives/android_service_dialog.html" rel="alternate"></link><published>2013-11-05T00:00:00+08:00</published><updated>2013-11-05T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-11-05:/archives/android_service_dialog.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="http://blog.csdn.net/huxueyan521/article/details/8954844"&gt;service中显示一个dialog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.cnblogs.com/noTice520/archive/2011/02/01/1948738.html"&gt;android UI进阶之style和theme的使用&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;简介&lt;/h3&gt;
&lt;p&gt;有一个Dialog需要在多个应用中的多个位置调用，需要用Intent调起，于是想出的办法是Intent调起一个Service，重写这个Service的&lt;code&gt;onStartCommand&lt;/code&gt;方法在其中弹出Dialog。弹出Dialog后发现主题与软件整体采用的&lt;code&gt;Theme.Holo.Light&lt;/code&gt;不一致，于是找到了为弹出的对话框设置主题的方法，在文中给出。&lt;/p&gt;
&lt;h3&gt;Services中弹出Dialog&lt;/h3&gt;
&lt;p&gt;新建一个Service并在&lt;code&gt;AndroidManifest.xml&lt;/code&gt;中声明&lt;code&gt;Service&lt;/code&gt;和&lt;code&gt;intent-filter&lt;/code&gt;，在需要的地方用Intent调起，不谈。&lt;/p&gt;
&lt;p&gt;用&lt;code&gt;startService(intent)&lt;/code&gt;调起Service后的操作需要重写&lt;code&gt;onStartCommand&lt;/code&gt;方法，在其中尝试按照平常的方法调起Dialog：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Dialog&lt;/span&gt; &lt;span class="n"&gt;dialog&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Dialog&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;dialog&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setContentView&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;layout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;something&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;dialog&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;show&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样尝试调起Dialog会引起错误：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="http://blog.csdn.net/huxueyan521/article/details/8954844"&gt;service中显示一个dialog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.cnblogs.com/noTice520/archive/2011/02/01/1948738.html"&gt;android UI进阶之style和theme的使用&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;简介&lt;/h3&gt;
&lt;p&gt;有一个Dialog需要在多个应用中的多个位置调用，需要用Intent调起，于是想出的办法是Intent调起一个Service，重写这个Service的&lt;code&gt;onStartCommand&lt;/code&gt;方法在其中弹出Dialog。弹出Dialog后发现主题与软件整体采用的&lt;code&gt;Theme.Holo.Light&lt;/code&gt;不一致，于是找到了为弹出的对话框设置主题的方法，在文中给出。&lt;/p&gt;
&lt;h3&gt;Services中弹出Dialog&lt;/h3&gt;
&lt;p&gt;新建一个Service并在&lt;code&gt;AndroidManifest.xml&lt;/code&gt;中声明&lt;code&gt;Service&lt;/code&gt;和&lt;code&gt;intent-filter&lt;/code&gt;，在需要的地方用Intent调起，不谈。&lt;/p&gt;
&lt;p&gt;用&lt;code&gt;startService(intent)&lt;/code&gt;调起Service后的操作需要重写&lt;code&gt;onStartCommand&lt;/code&gt;方法，在其中尝试按照平常的方法调起Dialog：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Dialog&lt;/span&gt; &lt;span class="n"&gt;dialog&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Dialog&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;dialog&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setContentView&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;layout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;something&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;span class="n"&gt;dialog&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;show&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样尝试调起Dialog会引起错误：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;FATAL&lt;/span&gt; &lt;span class="nl"&gt;EXCEPTION&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;main&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;java&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;RuntimeException&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Unable&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;edu&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bupt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contacts&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;edial&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EdialService&lt;/span&gt;&lt;span class="mi"&gt;@428&lt;/span&gt;&lt;span class="n"&gt;be268&lt;/span&gt; &lt;span class="n"&gt;with&lt;/span&gt; &lt;span class="n"&gt;Intent&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;act&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;edu&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bupt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EDIAL&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;has&lt;/span&gt; &lt;span class="n"&gt;extras&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WindowManager&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="nl"&gt;BadTokenException&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Unable&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;add&lt;/span&gt; &lt;span class="n"&gt;window&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="n"&gt;null&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;handleServiceArgs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2515&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;access&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="mi"&gt;1900&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;133&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;H&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;handleMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1300&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Handler&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dispatchMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Handler&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;99&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Looper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loop&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Looper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;137&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4794&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;java&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reflect&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Method&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;invokeNative&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Native&lt;/span&gt; &lt;span class="n"&gt;Method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;java&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reflect&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Method&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;invoke&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Method&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;511&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;internal&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ZygoteInit&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;MethodAndArgsCaller&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ZygoteInit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;789&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;internal&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ZygoteInit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ZygoteInit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;556&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;dalvik&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;system&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;NativeStart&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Native&lt;/span&gt; &lt;span class="n"&gt;Method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Caused&lt;/span&gt; &lt;span class="nl"&gt;by&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WindowManager&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="nl"&gt;BadTokenException&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Unable&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;add&lt;/span&gt; &lt;span class="n"&gt;window&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt; &lt;span class="n"&gt;token&lt;/span&gt; &lt;span class="n"&gt;null&lt;/span&gt; &lt;span class="n"&gt;is&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ViewRootImpl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setView&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ViewRootImpl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;589&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WindowManagerImpl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;addView&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;WindowManagerImpl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;326&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WindowManagerImpl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;addView&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;WindowManagerImpl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;224&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;view&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;WindowManagerImpl&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;CompatModeWrapper&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;addView&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;WindowManagerImpl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;149&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Dialog&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Dialog&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;277&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;edu&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;bupt&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;contacts&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;edial&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;EdialService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;onStartCommand&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;EdialService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;57&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;at&lt;/span&gt; &lt;span class="n"&gt;android&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;handleServiceArgs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ActivityThread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nl"&gt;java&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2498&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mo"&gt;05&lt;/span&gt; &lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;04.439&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;E&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;AndroidRuntime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;18271&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="p"&gt;...&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt; &lt;span class="n"&gt;more&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这是因为我们的Dialog没有依附于一个Activity，所以需要将其设置成系统界别的Dialog，即全局性质的Dialog，在任何界面下都可以弹出来。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;dialog&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getWindow&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;setType&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;WindowManager&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;LayoutParams&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TYPE_SYSTEM_ALERT&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样就可以成功弹出Dialog了&lt;/p&gt;
&lt;h3&gt;为Dialog设置主题&lt;/h3&gt;
&lt;p&gt;通过上面的方法启动的Dialog，主题默认是&lt;code&gt;Theme.Holo&lt;/code&gt;，与我们需求的&lt;code&gt;Theme.Holo.Light&lt;/code&gt;不一致。而且这个Dialog不依附于Activity，无法通过在&lt;code&gt;AndroidManifest.xml&lt;/code&gt;中为Acitivity设置主题来控制Dialog的主题，于是需要在代码中控制主题。&lt;/p&gt;
&lt;p&gt;首先在&lt;code&gt;values/styles.xml&lt;/code&gt;中设置一个自定义的主题，为了方便做一些修改。也可以直接在下一步使用系统主题。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;style&lt;/span&gt; &lt;span class="na"&gt;name=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;HoloDialogTheme&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;parent=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;@android:style/Theme.Holo.Light.Dialog&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/style&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Dialog类并没有提供直接设置主题的方法，只有一个构造函数（两个参数的构造函数，第二个int参数表示主题）可以设置主题，所以需要重写Dialog类，重写构造函数。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;HoloDialog&lt;/span&gt; &lt;span class="kd"&gt;extends&lt;/span&gt; &lt;span class="n"&gt;Dialog&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;

    &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="nf"&gt;HoloDialog&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;Context&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="c1"&gt;// super(context);&lt;/span&gt;
        &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;style&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;HoloDialogTheme&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在Service中启动Dialog时使用这个新建的&lt;code&gt;HoloDialog&lt;/code&gt;，就可以使用这个主题了。&lt;/p&gt;
&lt;p&gt;有了这个类，就可以将之前设置的&lt;code&gt;TYPE_SYSTEM_ALERT&lt;/code&gt;也放到这里的构造函数中。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;HoloDialog&lt;/span&gt; &lt;span class="kd"&gt;extends&lt;/span&gt; &lt;span class="n"&gt;Dialog&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;

    &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="nf"&gt;HoloDialog&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;Context&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="c1"&gt;// super(context);&lt;/span&gt;
        &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;R&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;style&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;HoloDialogTheme&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getWindow&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;setType&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;WindowManager&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;LayoutParams&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TYPE_SYSTEM_ALERT&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Android"></category></entry><entry><title>Android原生日历应用分析和简单扩展</title><link href="https://x7blog.info/archives/android_calendar.html" rel="alternate"></link><published>2013-10-09T00:00:00+08:00</published><updated>2013-10-09T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-10-09:/archives/android_calendar.html</id><summary type="html">&lt;p&gt;参考:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2013/0222/896.html"&gt;Android 4.0日历（calendar）源码分析之概览&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://code.google.com/p/android-project-sse-ustc/"&gt;Google Code - android-project-sse-ustc&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;简介:&lt;/h3&gt;
&lt;p&gt;学校实验室的项目，其中一部分需求要修改原生的Android日历应用，加入部分额外的功能。本文介绍对Android源码中日历模块的分析，另外简单实现了农历的显示。&lt;a href="https://github.com/x7hub/Calendar_lunar"&gt;部分修改的源码&lt;/a&gt;上传到了github，由于参加与公司的合作项目，所以只提交了完成农历显示的版本，之后的版本不便给出。&lt;/p&gt;
&lt;p&gt;本文日历模块特指Android 4.1源码中的&lt;code&gt;com.android.calendar&lt;/code&gt;，没有对calendar provider做分析。&lt;/p&gt;
&lt;h3&gt;主要结构&lt;/h3&gt;
&lt;p&gt;首先需要说明，在Google给出的Android代码中单独取出Calendar模块，是不能在eclipse中直接编译运行的。单独编译运行的方法参考&lt;a href="http://x7hub.github.io/pages/android_app_compile.html"&gt;另一篇博文&lt;/a&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;日历应用有四个主要视图，分别是月视图，周视图，日视图，日程视图。&lt;/p&gt;
&lt;p&gt;&lt;img alt="月视图" src="/images/android_calendar-00.png"&gt;
&lt;img alt="周视图" src="/images/android_calendar-01.png"&gt;
&lt;img alt="日视图" src="/images/android_calendar-02.png"&gt;
&lt;img alt="日程视图" src="/images/android_calendar-03.png"&gt;&lt;/p&gt;
&lt;p&gt;四个视图对应4个Fragment，都附着于&lt;code&gt;AllInOneActivity&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;月视图：&lt;code&gt;month/MonthByWeekFragment.java&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;日视图和周视图：&lt;code&gt;DayFragment.java&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;日程视图 …&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;参考:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2013/0222/896.html"&gt;Android 4.0日历（calendar）源码分析之概览&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://code.google.com/p/android-project-sse-ustc/"&gt;Google Code - android-project-sse-ustc&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;简介:&lt;/h3&gt;
&lt;p&gt;学校实验室的项目，其中一部分需求要修改原生的Android日历应用，加入部分额外的功能。本文介绍对Android源码中日历模块的分析，另外简单实现了农历的显示。&lt;a href="https://github.com/x7hub/Calendar_lunar"&gt;部分修改的源码&lt;/a&gt;上传到了github，由于参加与公司的合作项目，所以只提交了完成农历显示的版本，之后的版本不便给出。&lt;/p&gt;
&lt;p&gt;本文日历模块特指Android 4.1源码中的&lt;code&gt;com.android.calendar&lt;/code&gt;，没有对calendar provider做分析。&lt;/p&gt;
&lt;h3&gt;主要结构&lt;/h3&gt;
&lt;p&gt;首先需要说明，在Google给出的Android代码中单独取出Calendar模块，是不能在eclipse中直接编译运行的。单独编译运行的方法参考&lt;a href="http://x7hub.github.io/pages/android_app_compile.html"&gt;另一篇博文&lt;/a&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;日历应用有四个主要视图，分别是月视图，周视图，日视图，日程视图。&lt;/p&gt;
&lt;p&gt;&lt;img alt="月视图" src="/images/android_calendar-00.png"&gt;
&lt;img alt="周视图" src="/images/android_calendar-01.png"&gt;
&lt;img alt="日视图" src="/images/android_calendar-02.png"&gt;
&lt;img alt="日程视图" src="/images/android_calendar-03.png"&gt;&lt;/p&gt;
&lt;p&gt;四个视图对应4个Fragment，都附着于&lt;code&gt;AllInOneActivity&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;月视图：&lt;code&gt;month/MonthByWeekFragment.java&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;日视图和周视图：&lt;code&gt;DayFragment.java&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;日程视图：&lt;code&gt;agenda/AgendaFragment.java&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;其他重要视图对应的代码文件：&lt;/p&gt;
&lt;p&gt;日程新建、编辑：&lt;code&gt;event/EditEventFragment.java&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;日程详细信息：&lt;code&gt;EventInfoActivity.java&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;设置：&lt;code&gt;CalendarSettingActivity.java&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="日程新建、编辑" src="/images/android_calendar-04.png"&gt;
&lt;img alt="日程详细信息" src="/images/android_calendar-05.png"&gt; 
&lt;img alt="设置" src="/images/android_calendar-06.png"&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;加入农历显示功能&lt;/h3&gt;
&lt;p&gt;在google-code上找到了一段计算农历的代码，引用的位置&lt;a href="https://code.google.com/p/android-project-sse-ustc/"&gt;在这里&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;农历的计算使用代码中的&lt;a href="https://github.com/x7hub/Calendar_lunar/blob/master/src/edu/bupt/calendar/lunar/Lunar.java"&gt;Lunar.java&lt;/a&gt;文件。简单看了一下，并没有真的使用复杂的农历算法，而是利用一个数组预存了每一年的初一与1900年1月1日的差数，利用这个数组再做计算。具体参看代码不谈。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;lunarInfo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="mi"&gt;19416&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19168&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42352&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21717&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;53856&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;55632&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;91476&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;22176&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;39632&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21970&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19168&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42422&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42192&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;53840&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;119381&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46400&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;54944&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;44450&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;38320&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;84343&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;18800&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42160&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46261&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27216&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27968&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;109396&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;11104&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;38256&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21234&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;18800&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;25958&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;54432&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;59984&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;28309&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;23248&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;11104&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;100067&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;37600&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;116951&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;51536&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;54432&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;120998&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46416&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;22176&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;107956&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9680&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;37584&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;53938&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43344&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46423&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27808&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46416&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;86869&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19872&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42448&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;83315&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21200&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43432&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;59728&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27296&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;44710&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43856&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19296&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43748&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42352&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21088&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;62051&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;55632&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;23383&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;22176&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;38608&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19925&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19152&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42192&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;54484&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;53840&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;54616&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46400&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46496&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;103846&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;38320&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;18864&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43380&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42160&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;45690&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27216&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27968&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;44870&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43872&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;38256&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19189&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;18800&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;25776&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;29859&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;59984&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27480&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21952&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43872&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;38613&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;37600&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;51552&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;55636&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;54432&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;55888&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;30034&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;22176&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43959&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;9680&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;37584&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;51893&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43344&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46240&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;47780&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;44368&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21977&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19360&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42416&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;86390&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21168&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43312&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;31060&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27296&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;44368&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;23378&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19296&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42726&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42208&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;53856&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;60005&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;54576&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;23200&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;30371&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;38608&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19415&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;19152&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42192&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;118966&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;53840&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;54560&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;56645&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;46496&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;22224&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;21938&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;18864&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42359&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;42160&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;43600&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;111189&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;27936&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;44448&lt;/span&gt; &lt;span class="o"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在原本的代码中加入两个静态方法，方便在日历需要显示农历的地方调用。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;setLunar&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Context&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;month&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;day&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;

        &lt;span class="n"&gt;SharedPreferences&lt;/span&gt; &lt;span class="n"&gt;prefs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;GeneralPreferences&lt;/span&gt;
                &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSharedPreferences&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;setShowLunch&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;prefs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getBoolean&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;GeneralPreferences&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;KEY_SHOW_LUNAR&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;

        &lt;span class="c1"&gt;// if (!isSetShowLunar) {&lt;/span&gt;
        &lt;span class="c1"&gt;// return;&lt;/span&gt;
        &lt;span class="c1"&gt;// }&lt;/span&gt;
        &lt;span class="n"&gt;syear&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;smonth&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;month&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;sday&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;day&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;

        &lt;span class="n"&gt;Date&lt;/span&gt; &lt;span class="n"&gt;sDObj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;syear&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1900&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;smonth&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sday&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;Lunar1&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sDObj&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;

    &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="nf"&gt;getLunar&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(!&lt;/span&gt;&lt;span class="n"&gt;isSetShowLunar&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;
        &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;sy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
        &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;农历 【&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;Animals&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;sy&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;】&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;cYear&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getYear&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;年&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;

        &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="n"&gt;getIsLeap&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;闰&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;monthNong&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;getMonth&lt;/span&gt;&lt;span class="o"&gt;()]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;月&amp;quot;&lt;/span&gt;
                &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="o"&gt;((!&lt;/span&gt;&lt;span class="n"&gt;getIsBig&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;小&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;大&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;

        &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;cDay&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getDay&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;

        &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;cyclical&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getYearCyl&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;年&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;cyclical&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getMonCyl&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;月&amp;quot;&lt;/span&gt;
                &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;cyclical&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;getDayCyl&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;日&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在需要显示农历时，通过&lt;code&gt;Lunar.java&lt;/code&gt;计算农历。比如&lt;code&gt;month/SimpleWeekView.java&lt;/code&gt;的&lt;code&gt;setWeekParams&lt;/code&gt;方法遍历&lt;code&gt;mNumCells&lt;/code&gt;的过程中加入，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;        &lt;span class="n"&gt;Context&lt;/span&gt; &lt;span class="n"&gt;context&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getContext&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
        &lt;span class="n"&gt;Lunar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setLunar&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;year&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;month&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;monthDay&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
        &lt;span class="n"&gt;mLunarNumbers&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Lunar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getLunarDayForDisplay&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然后在&lt;code&gt;month/MonthWeekEventsView.java&lt;/code&gt;中&lt;code&gt;drawWeekNums&lt;/code&gt;方法中遍历&lt;code&gt;numCount&lt;/code&gt;时加入，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;        &lt;span class="n"&gt;canvas&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;drawText&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mLunarNumbers&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;],&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mMonthNumPaint&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;类似地，可以在&lt;code&gt;CalendarViewAdapter.java&lt;/code&gt;和&lt;code&gt;agenda/AgendaByDayAdapter.java&lt;/code&gt;中加入农历显示。&lt;/p&gt;
&lt;h3&gt;加入VCalendar文件分享功能&lt;/h3&gt;
&lt;p&gt;在&lt;code&gt;EventInfoFragment.java&lt;/code&gt;中，添加了分享日程的功能，打包成VCalendar类型的vcs文件，通过&lt;code&gt;Intent.ACTION_SEND&lt;/code&gt;发送到彩信或者邮件应用。&lt;/p&gt;
&lt;p&gt;Android源码中包括了一个&lt;code&gt;ICalendar&lt;/code&gt;类，用于处理VCalendar文件，但是并没有实现(或者是没有保留？)导入导出的功能。&lt;code&gt;ICanlendar&lt;/code&gt;类内部实现就是对字符串的处理，使用也很简单，导出功能可以用以下代码实现，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Component&lt;/span&gt; &lt;span class="n"&gt;component&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Component&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Component&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;VCALENDAR&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Component&lt;/span&gt; &lt;span class="n"&gt;child&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Component&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Component&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;VEVENT&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;

    &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;tzid&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="c1"&gt;//&lt;/span&gt;
    &lt;span class="n"&gt;Utils&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSharedPreference&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mContext&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;GeneralPreferences&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;KEY_HOME_TZ_ENABLED&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;
            &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="c1"&gt;//&lt;/span&gt;
    &lt;span class="n"&gt;Utils&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getSharedPreference&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="c1"&gt;//&lt;/span&gt;
            &lt;span class="n"&gt;mContext&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;GeneralPreferences&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;KEY_HOME_TZ&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;TimeZone&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getDefault&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getID&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;//&lt;/span&gt;
            &lt;span class="n"&gt;TimeZone&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getDefault&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getID&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;

    &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt; &lt;span class="n"&gt;dtstart_prop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="s"&gt;&amp;quot;DTSTART&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="c1"&gt;//&lt;/span&gt;
            &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;SimpleDateFormat&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;yyyyMMdd&amp;#39;T&amp;#39;HHmmss&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
                    &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;format&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mStartMillis&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;
    &lt;span class="n"&gt;dtstart_prop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addParameter&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Parameter&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;TZID&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tzid&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;
    &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dtstart_prop&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;

    &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt; &lt;span class="n"&gt;dtend_prop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="s"&gt;&amp;quot;DTEND&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="c1"&gt;//&lt;/span&gt;
            &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;SimpleDateFormat&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;yyyyMMdd&amp;#39;T&amp;#39;HHmmss&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
                    &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;format&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mEndMillis&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;
    &lt;span class="n"&gt;dtend_prop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addParameter&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Parameter&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;TZID&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tzid&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt;
    &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dtend_prop&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;

    &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;SUMMARY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;mTitle&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getText&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="o"&gt;()));&lt;/span&gt;
    &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="s"&gt;&amp;quot;LOCATION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mWhere&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getText&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="o"&gt;()));&lt;/span&gt;
    &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="s"&gt;&amp;quot;DISCRIPTION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;mDesc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getText&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="o"&gt;()));&lt;/span&gt;

    &lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addChild&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;Log&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;d&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;info_action_share&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;component&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;导入时，同样使用&lt;code&gt;ICalendar&lt;/code&gt;类，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="n"&gt;event_title&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFirstProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;SUMMARY&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;

    &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt; &lt;span class="n"&gt;dtstart_prop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFirstProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;DTSTART&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;ICalendar&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Property&lt;/span&gt; &lt;span class="n"&gt;dtend_prop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFirstProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;DTEND&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event_tz&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dtstart_prop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFirstParameter&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;TZID&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;value&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;SimpleDateFormat&lt;/span&gt; &lt;span class="n"&gt;simpleDateFormat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;SimpleDateFormat&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="s"&gt;&amp;quot;yyyyMMdd&amp;#39;T&amp;#39;HHmmss&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;event_datetime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simpleDateFormat&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dtstart_prop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt;
                &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTime&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
        &lt;span class="n"&gt;event_dateendtime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;simpleDateFormat&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dtend_prop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt;
                &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTime&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ParseException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printStackTrace&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;

    &lt;span class="n"&gt;event_where&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFirstProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;LOCATION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="n"&gt;event_disc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;child&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFirstProperty&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;DISCRIPTION&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;保存日程，&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="n"&gt;ContentValues&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ContentValues&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;event_title&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;event_disc&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;eventLocation&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;event_where&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;calendar_id&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;calId&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dtstart&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;event_datetime&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dtend&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;event_dateendtime&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;hasAlarm&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;eventTimezone&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;event_tz&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;eventStatus&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
    &lt;span class="n"&gt;Uri&lt;/span&gt; &lt;span class="n"&gt;newEvent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getContentResolver&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;insert&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;Uri&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;content://com.android.calendar/events&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt; &lt;span class="n"&gt;event&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;其他&lt;/h3&gt;
&lt;p&gt;其他还做了很多修改，暂时还不便给出，以后有机会会放到github上。&lt;/p&gt;</content><category term="Android"></category></entry><entry><title>Android源码中日历模块单独编译</title><link href="https://x7blog.info/archives/android_app_compile.html" rel="alternate"></link><published>2013-10-08T00:00:00+08:00</published><updated>2013-10-08T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-10-08:/archives/android_app_compile.html</id><summary type="html">&lt;p&gt;参考:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://blog.csdn.net/xixinyan/article/details/6942074"&gt;在Eclipse中开发Android系统的内置应用(Mms, Contacts ect)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://blog.csdn.net/zhu_apollo/article/details/8760025"&gt;android4.0.3 联系人Contacts应用导入到eclipse中编译运行之一&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Android 源码下载：&lt;/h3&gt;
&lt;p&gt;利用&lt;code&gt;repo&lt;/code&gt;工具下载Google原生的Android源码。参考&lt;a href="http://source.android.com/source/downloading.html"&gt;Google官方文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;高通芯片对应的Android&lt;a href="https://www.codeaurora.org/xwiki/bin/QRD-Android/"&gt;源码下载&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;Android源码结构：&lt;/h3&gt;
&lt;p&gt;Google提供的Android包含了：Android源代码，工具链，基础C库，仿真环境，开发环境等。&lt;/p&gt;
&lt;p&gt;第一级别的目录和文件如下所示：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;　　----------------
　　　|-- Makefile            全局的Makefile
　　　|-- build               系统编译规则和配置所需要的脚本和工具
　　----------------
　　　|-- prebuilt        各种平台编译工具链
　　　|-- bionic              基础C库源代码
　　----------------
　　　|-- frameworks *        Android应用程序的核心框架层(java及C++语言)
　　　|-- system     *        底层文件系统/库/应用及组件(C语言)
　　　|-- dalvik              JAVA虚拟机
　　　|-- external            android使用的一些额外开源库
　　　|-- libcore             与媒体播放框架代码相关
　　----------------
　　　|-- packages …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;参考:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://blog.csdn.net/xixinyan/article/details/6942074"&gt;在Eclipse中开发Android系统的内置应用(Mms, Contacts ect)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://blog.csdn.net/zhu_apollo/article/details/8760025"&gt;android4.0.3 联系人Contacts应用导入到eclipse中编译运行之一&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Android 源码下载：&lt;/h3&gt;
&lt;p&gt;利用&lt;code&gt;repo&lt;/code&gt;工具下载Google原生的Android源码。参考&lt;a href="http://source.android.com/source/downloading.html"&gt;Google官方文档&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;高通芯片对应的Android&lt;a href="https://www.codeaurora.org/xwiki/bin/QRD-Android/"&gt;源码下载&lt;/a&gt;。&lt;/p&gt;
&lt;h3&gt;Android源码结构：&lt;/h3&gt;
&lt;p&gt;Google提供的Android包含了：Android源代码，工具链，基础C库，仿真环境，开发环境等。&lt;/p&gt;
&lt;p&gt;第一级别的目录和文件如下所示：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;　　----------------
　　　|-- Makefile            全局的Makefile
　　　|-- build               系统编译规则和配置所需要的脚本和工具
　　----------------
　　　|-- prebuilt        各种平台编译工具链
　　　|-- bionic              基础C库源代码
　　----------------
　　　|-- frameworks *        Android应用程序的核心框架层(java及C++语言)
　　　|-- system     *        底层文件系统/库/应用及组件(C语言)
　　　|-- dalvik              JAVA虚拟机
　　　|-- external            android使用的一些额外开源库
　　　|-- libcore             与媒体播放框架代码相关
　　----------------
　　　|-- packages            各种应用程序实例
　　　|-- development         程序开发所需要的实例/模板/工具
　　----------------
　　　|-- ndk
　　　|-- sdk
　　　|-- cts                 Android CTS兼容性规范测试用例
　　----------------
　　　|-- vendor     *        厂商定制代码
　　　|-- device     *        厂商定制代码
　　　|-- hardware   *        一些与硬件相关的库，部分厂家开源的硬解适配层HAL代码
　　　|-- kernel     *        Linux源代码
　　　|-- bootable            引导加载器
　　　|-- recovery            与目标的恢复功能相关
　　　----------------
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;packages&lt;/code&gt;中包含两个主要目录，其中&lt;code&gt;apps&lt;/code&gt;中是Android中的各种应用程序，&lt;code&gt;providers&lt;/code&gt;是一些内容提供者（是内部自带的数据库源程序）。两个目录的内容大都是使用JAVA编写的程序，各个文件夹的层次结构是类似的。&lt;/p&gt;
&lt;p&gt;作为基于SDK的开发者需要的是&lt;code&gt;packages/apps&lt;/code&gt;目录下的程序实例。&lt;/p&gt;
&lt;h3&gt;Calendar应用在eclipse中单独编译&lt;/h3&gt;
&lt;p&gt;复制出&lt;code&gt;packages/apps/Calendar&lt;/code&gt;文件夹，其中包括了Calendar应用的主要代码。但是如果直接import到eclipse中，会因为对源码中的其他文件的依赖而报错不能编译。因此，需要在源码包中找到缺少的依赖文件，并引入到单独复制出的Calendar工程中，将所有因依赖产生的错误解决后，就可以编译运行了。&lt;/p&gt;
&lt;p&gt;解决Calendar应用的依赖文件时遇到两种类型：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;由于java文件缺失造成的依赖错误。在eclipse的代码框中报错，显示找不到类定义。出现这种错误时，应该在Android源码中找到报错的类对应的定义文件，通常为&lt;code&gt;java&lt;/code&gt;或&lt;code&gt;aidl&lt;/code&gt;文件，将文件复制到Calendar工程相应的目录下，可以解决报错。例如，&lt;code&gt;com.android.calendar&lt;/code&gt;包中的&lt;code&gt;CalendarEventModel.java&lt;/code&gt;文件中，&lt;code&gt;import com.android.common.Rfc822Validator&lt;/code&gt;语句报错，于是在源码目录中搜索&lt;code&gt;Rfc822Validator.java&lt;/code&gt;，找到&lt;code&gt;frameworks/ex/common/java/com/android/common/Rfc822Validator.java&lt;/code&gt;，将&lt;code&gt;Rfc822Validator.java&lt;/code&gt;复制到&lt;code&gt;Calendar/src/com/android/common/&lt;/code&gt;文件夹下，在eclipse中刷新整个工程目录，报错的语句就被解决了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;由于资源文件造成的依赖错误。为了解决找不到类定义的错误，在Calendar工程中引入了Android源码中其他目录的&lt;code&gt;java&lt;/code&gt;文件，这些文件会调用到各自目录的&lt;code&gt;res&lt;/code&gt;文件，都需要将他们引入到Calendar工程中。例如，为了解决&lt;code&gt;EditEventView.java&lt;/code&gt;的包中的错误，引入了&lt;code&gt;com.android.ex.chips&lt;/code&gt;包中的&lt;code&gt;RecipientEditTextView.java&lt;/code&gt;文件，而其中引用的&lt;code&gt;R.string.copy_number&lt;/code&gt;不存在，就需要在源码中的&lt;code&gt;com.android.ex.chips&lt;/code&gt;包里找到&lt;code&gt;strings.xml&lt;/code&gt;中的&lt;code&gt;copy_number&lt;/code&gt;项，复制到Calendar工程中的&lt;code&gt;strings.xml&lt;/code&gt;中。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;为了在源码环境外编译原生Calendar应用，总共引入了以下源码中的文件。其中，首行表示Calendar工程中报错的文件，为了解决报错引入了随后几行的文件。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;　　CalendarEventModel.java
　　frameworks/ex/common/java/com/android/common/Rfc822Validator.java
　　　　　
　　DeleteEventHelper.java
　　frameworks/opt/calendar/src/com/android/calendarcommon/EventRecurrence.java

　　EmailAddressAdapter.java
　　frameworks/ex/common/java/com/android/common/contacts/BaseEmailAddressAdapter.java
　　frameworks/ex/common/java/com/android/common/widget/CompositeCursorAdapter.java
　　frameworks/ex/chips/src/com/android/ex/chips/AccountSpecifier.java
　　
　　GoogleCalendarUriIntentFilter.java
　　frameworks/opt/calendar/src/com/android/calendarcommon/DataException.java
　　frameworks/opt/calendar/src/com/android/calendarcommon/Duration.java

　　RecipientAdapter.java
　　frameworks/ex/chips/src/com/android/ex/chips/BaseRecipientAdapter.java
　　frameworks/ex/chips/src/com/android/ex/chips/Queries.java
　　frameworks/ex/chips/src/com/android/ex/chips/RecipientEntry.java
　　frameworks/ex/chips/res/layout/chips_recipient_dropdown_item.xml
　　frameworks/ex/chips/res/drawable/list_item_font_primary.xml
　　frameworks/ex/chips/res/drawable/list_item_font_secondary.xml

　　EditEventHelper.java
　　frameworks/opt/calendar/src/com/android/calendarcommon/RecurrenceProcessor.java
　　frameworks/opt/calendar/src/com/android/calendarcommon/RecurrenceSet.java
　　frameworks/opt/calendar/src/com/android/calendarcommon/ICalendar.java

　　EditEventView.java
　　frameworks/ex/common/java/com/android/common/Rfc822InputFilter.java
　　frameworks/ex/chips/src/com/android/ex/chips/ChipsUtil.java
　　frameworks/ex/chips/src/com/android/ex/chips/RecipientEditTextView.java
　　frameworks/ex/chips/src/com/android/ex/chips/RecipientAlternatesAdapter.java
　　frameworks/ex/chips/src/com/android/ex/chips/RecipientChip.java
　　frameworks/ex/chips/res/values/strings.xml
　　frameworks/ex/chips/res/values/attrs.xml
　　frameworks/ex/chips/res/drawable-{hdpi,mdpi,xhdpi}/{chip_background.9.png,chip_delete.png,chip_background_invalid.9.png,chip_background_selected.9.png}
　　frameworks/ex/chips/src/com/android/ex/chips/SingleRecipientArrayAdapter.java
&lt;/pre&gt;&lt;/div&gt;</content><category term="Android"></category></entry><entry><title>在本地建立DNS缓存</title><link href="https://x7blog.info/archives/local_dns.html" rel="alternate"></link><published>2013-09-29T00:00:00+08:00</published><updated>2013-09-29T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-09-29:/archives/local_dns.html</id><summary type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Dnsmasq"&gt;dnsmasq - ArchWiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://tieba.baidu.com/p/1034963853"&gt;用dnsmasq加速你的网络!!!&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;dnsmasq&lt;/h3&gt;
&lt;p&gt;Dnsmasq 提供 DNS 缓存和 DHCP 服务功能。作为域名解析服务器(DNS)，dnsmasq可以通过缓存 DNS 请求来提高对访问过的网址的连接速度。作为DHCP 服务器，dnsmasq 可以为局域网电脑提供内网ip地址和路由。DNS和DHCP两个功能可以同时或分别单独实现。dnsmasq轻量且易配置，适用于个人用户或少于50台主机的网络。此外它还自带了一个 PXE 服务器。&lt;/p&gt;
&lt;h3&gt;配置&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;首先安装：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pacman -S dnsmasq
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;修改配置文件&lt;code&gt;/etc/dnsmasq.conf&lt;/code&gt;。指定用于域名查询的配置文件，反注释并修改这一行：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;resolv-file=/etc/resolv_dnsmasq.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;这个文件不存在啊？当然是需要自己创建的，复制前要保证&lt;code&gt;/etc/resolv.conf&lt;/code&gt;是原本配置好的或者被&lt;code&gt;networkmanager&lt;/code&gt;等应用自动生成的 …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Dnsmasq"&gt;dnsmasq - ArchWiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://tieba.baidu.com/p/1034963853"&gt;用dnsmasq加速你的网络!!!&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;dnsmasq&lt;/h3&gt;
&lt;p&gt;Dnsmasq 提供 DNS 缓存和 DHCP 服务功能。作为域名解析服务器(DNS)，dnsmasq可以通过缓存 DNS 请求来提高对访问过的网址的连接速度。作为DHCP 服务器，dnsmasq 可以为局域网电脑提供内网ip地址和路由。DNS和DHCP两个功能可以同时或分别单独实现。dnsmasq轻量且易配置，适用于个人用户或少于50台主机的网络。此外它还自带了一个 PXE 服务器。&lt;/p&gt;
&lt;h3&gt;配置&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;首先安装：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pacman -S dnsmasq
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;修改配置文件&lt;code&gt;/etc/dnsmasq.conf&lt;/code&gt;。指定用于域名查询的配置文件，反注释并修改这一行：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;resolv-file=/etc/resolv_dnsmasq.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;这个文件不存在啊？当然是需要自己创建的，复制前要保证&lt;code&gt;/etc/resolv.conf&lt;/code&gt;是原本配置好的或者被&lt;code&gt;networkmanager&lt;/code&gt;等应用自动生成的，没被修改过。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo cp /etc/resolv.conf /etc/resolv_dnsmasq.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;启用&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;修改系统dns服务器地址设置。如果使用了&lt;code&gt;networkmanager&lt;/code&gt;等管理网络的应用，在其中修改使用的网络连接，取消自动获取dns服务器的选框，设定&lt;code&gt;127.0.0.1&lt;/code&gt;为默认dns。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果没有使用，那么系统是通过直接读取用户设置的&lt;code&gt;/etc/resolv.conf&lt;/code&gt;来获取dns服务器，那么直接修改这个文件即可：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nameserver 127.0.0.1
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;然后启动dnsmasq服务：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo systemctl start dnsmasq.service
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;测试&lt;/h3&gt;
&lt;p&gt;开启后测试一下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dig g.cn
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看到这么一行：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;;; SERVER: 127.0.0.1#53(127.0.0.1)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这就成功了。由于使用本地的缓存，就不必担心学校的dns服务器再瘫掉导致没法上网了。或者还可以使用8.8.8.8作为dnsmasq的上游，更稳定，不过会导致解析学校的登陆网关出问题。&lt;/p&gt;
&lt;p&gt;另外，&lt;a href="https://wiki.archlinux.org/index.php/Dnsmasq#DNS_Caching"&gt;archwiki&lt;/a&gt;上有这么一段：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;To do a lookup speed test choose a website that has not been visited since dnsmasq has been started (dig is part of the dnsutils package):&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ dig archlinux.org | grep "Query time"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Running the command again will use the cached DNS IP and result in a faster lookup time if dnsmasq is setup correctly.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;于是就试了一下：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~ % dig archlinux.org &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s2"&gt;&amp;quot;Query time&amp;quot;&lt;/span&gt;              commander@myhost pts/2 &lt;span class="m"&gt;19&lt;/span&gt;:11 
&lt;span class="p"&gt;;;&lt;/span&gt; Query time: &lt;span class="m"&gt;315&lt;/span&gt; msec
~ % dig archlinux.org &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s2"&gt;&amp;quot;Query time&amp;quot;&lt;/span&gt;              commander@myhost pts/2 &lt;span class="m"&gt;19&lt;/span&gt;:12 
&lt;span class="p"&gt;;;&lt;/span&gt; Query time: &lt;span class="m"&gt;0&lt;/span&gt; msec
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;确实效果明显。但是，关掉了dnsmasq并设置使用自动获取的dns服务，一样也是这样的效果，看来学校给的dns服务器也是大概使用了这种缓存机制吧。&lt;/p&gt;</content><category term="Linux"></category><category term="dns"></category></entry><entry><title>修改hosts访问github</title><link href="https://x7blog.info/archives/github_hosts.html" rel="alternate"></link><published>2013-09-08T00:00:00+08:00</published><updated>2013-09-08T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-09-08:/archives/github_hosts.html</id><summary type="html">&lt;p&gt;学校不知道抽的什么风，突然就不让上github了，于是修改&lt;code&gt;/etc/hosts&lt;/code&gt;加入：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# github
207.97.227.239 github.com
65.74.177.129 www.github.com
207.97.227.252 nodeload.github.com
207.97.227.243 raw.github.com
204.232.175.78 documentcloud.github.com
204.232.175.78 pages.github.com
&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;学校不知道抽的什么风，突然就不让上github了，于是修改&lt;code&gt;/etc/hosts&lt;/code&gt;加入：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# github
207.97.227.239 github.com
65.74.177.129 www.github.com
207.97.227.252 nodeload.github.com
207.97.227.243 raw.github.com
204.232.175.78 documentcloud.github.com
204.232.175.78 pages.github.com
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="hosts"></category></entry><entry><title>在Github Pages上搭建个人博客</title><link href="https://x7blog.info/archives/build_my_blog.html" rel="alternate"></link><published>2013-08-27T00:00:00+08:00</published><updated>2013-08-27T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-08-27:/archives/build_my_blog.html</id><summary type="html">&lt;p&gt;参考:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.lizherui.com/pages/2013/08/17/build_blog.html"&gt;一步一步打造Geek风格的技术博客 by lizherui&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://x-wei.github.io/pelican_github_blog.html"&gt;用pelican在github上创建自己的博客! by mx&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.linuxzen.com/shi-yong-pelicanda-zao-jing-tai-bo-ke.html"&gt;使用Pelican打造静态博客 by cold&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;搭建环境&lt;/h3&gt;
&lt;p&gt;在Linux环境下搭建，我使用的是Archlinux i686，使用其它发行版过程基本相同。&lt;/p&gt;
&lt;h3&gt;Github Pages&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;注册Github,注册和配置SSH密钥过程&lt;a href="http://help.github.com/articles/set-up-git"&gt;help page&lt;/a&gt;写得很清楚。&lt;/li&gt;
&lt;li&gt;在Github创建一个名为username.github.io的版本库（将username替换成自己的Github账户名）。&lt;/li&gt;
&lt;li&gt;Setting -&amp;gt; Automatic page generator -&amp;gt; Continue to layout，选择一个模板，并发布。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这时在username.github.io页面就已经生成了一个页面。&lt;/p&gt;
&lt;h3&gt;本地搭建&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;安装pelican和markdown：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yaourt pelican
yaourt markdown
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;搭建目录：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir blog
&lt;span class="nb"&gt;cd&lt;/span&gt; blog
pelican-quickstart …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;参考:&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.lizherui.com/pages/2013/08/17/build_blog.html"&gt;一步一步打造Geek风格的技术博客 by lizherui&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://x-wei.github.io/pelican_github_blog.html"&gt;用pelican在github上创建自己的博客! by mx&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.linuxzen.com/shi-yong-pelicanda-zao-jing-tai-bo-ke.html"&gt;使用Pelican打造静态博客 by cold&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;搭建环境&lt;/h3&gt;
&lt;p&gt;在Linux环境下搭建，我使用的是Archlinux i686，使用其它发行版过程基本相同。&lt;/p&gt;
&lt;h3&gt;Github Pages&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;注册Github,注册和配置SSH密钥过程&lt;a href="http://help.github.com/articles/set-up-git"&gt;help page&lt;/a&gt;写得很清楚。&lt;/li&gt;
&lt;li&gt;在Github创建一个名为username.github.io的版本库（将username替换成自己的Github账户名）。&lt;/li&gt;
&lt;li&gt;Setting -&amp;gt; Automatic page generator -&amp;gt; Continue to layout，选择一个模板，并发布。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这时在username.github.io页面就已经生成了一个页面。&lt;/p&gt;
&lt;h3&gt;本地搭建&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;安装pelican和markdown：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yaourt pelican
yaourt markdown
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;搭建目录：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir blog
&lt;span class="nb"&gt;cd&lt;/span&gt; blog
pelican-quickstart
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;生成的目录结构:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;blog/
├── content
│   └── *.md             &lt;span class="c1"&gt;# markdown文件&lt;/span&gt;
├── output               &lt;span class="c1"&gt;# 默认的输出目录&lt;/span&gt;
├── develop_server.sh
├── Makefile
├── pelicanconf.py       &lt;span class="c1"&gt;# 主配置文件&lt;/span&gt;
└── publishconf.py
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;clone之前生成的username.github.io版本库：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone git@github.com:username/username.github.io.git
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;为了直接向Github的username.github.io库中提交本地生成的文件：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mv username.github.io/.git .
rm -rf username.github.io
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样就可以将整个blog目录托管在github上。&lt;/p&gt;
&lt;h3&gt;修改配置文件&lt;/h3&gt;
&lt;h4&gt;配置Makefile&lt;/h4&gt;
&lt;p&gt;修改默认的&lt;code&gt;$OUTPUTDIR&lt;/code&gt;值，使之指向博客根目录而不是output目录，这是因为生成的index.html必须位于github托管目录的根目录，才能访问到网页。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;OUTPUTDIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;BASEDIR&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改&lt;code&gt;publish&lt;/code&gt;项的值，不必需要提供默认输出目录，另外指定pelidanconf.py为配置文件：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;publish&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;PELICAN&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;INPUTDIR&lt;span class="k"&gt;)&lt;/span&gt; -s &lt;span class="k"&gt;$(&lt;/span&gt;CONFFILE&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;PELICANOPTS&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;添加&lt;code&gt;github&lt;/code&gt;项，方便直接向github提交修改：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;github&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;publish&lt;/span&gt;
    &lt;span class="nb"&gt;cd&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;OUTPUTDIR&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; git add .&lt;span class="p"&gt;;&lt;/span&gt; git commit -am &lt;span class="s1"&gt;&amp;#39;zzz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; git push
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;另外可以删除掉不必要的项。&lt;/p&gt;
&lt;h4&gt;配置pelicanconf.py&lt;/h4&gt;
&lt;p&gt;修改&lt;code&gt;AUTHOR&lt;/code&gt;，&lt;code&gt;SITENAME&lt;/code&gt;，&lt;code&gt;TIMEZONE&lt;/code&gt;，&lt;code&gt;DEFAULT_LANG&lt;/code&gt;，&lt;code&gt;GITHUB_URL&lt;/code&gt;，&lt;code&gt;LINKS&lt;/code&gt;，&lt;code&gt;SOCIAL&lt;/code&gt;等选项：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;AUTHOR&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;x7&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;SITENAME&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;x7&lt;/span&gt;&lt;span class="se"&gt;\&amp;#39;&lt;/span&gt;&lt;span class="s1"&gt;s &lt;/span&gt;
&lt;span class="n"&gt;TIMEZONE&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Asia/Beijing&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;DEFAULT_LANG&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;zhs&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;GITHUB_URL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;lt;https://github.com/x7hub&amp;gt;&amp;#39;&lt;/span&gt;

&lt;span class="n"&gt;LINKS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Pelican&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://getpelican.com/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ArchWiki&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;https://wiki.archlinux.org/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;SOCIAL&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;新浪微博&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;http://weibo.com/ulzzz&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
          &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;指定默认输出目录：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;OUTPUT_PATH&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;写博文&lt;/h3&gt;
&lt;p&gt;需要编辑的md文件应该位于content目录下，我暂时使用的编辑器是ReText，另外有一个在线的编辑器&lt;a href="http://mahua.jser.me"&gt;MaHua&lt;/a&gt;，还没尝试其他。&lt;/p&gt;
&lt;p&gt;pelican要求文章的开头必须有一些字段，如&lt;code&gt;Title&lt;/code&gt;等，比如本文的开头是这样的：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;2013&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;08&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;27&lt;/span&gt;
&lt;span class="n"&gt;Title&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="err"&gt;在&lt;/span&gt;&lt;span class="n"&gt;Github&lt;/span&gt; &lt;span class="n"&gt;Pages&lt;/span&gt;&lt;span class="err"&gt;上搭建个人博客&lt;/span&gt;
&lt;span class="n"&gt;Category&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;blog&lt;/span&gt;
&lt;span class="n"&gt;Tags&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;blog&lt;/span&gt;
&lt;span class="n"&gt;Slug&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;build_my_blog&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;编辑完成后，利用&lt;code&gt;make pulish&lt;/code&gt;生成博文，还可以通过&lt;code&gt;make serve&lt;/code&gt;在localhost:8000可以生成预览，如果完成了之前对Makefile的修改，就可以用&lt;code&gt;make github&lt;/code&gt;直接提交到Github。&lt;/p&gt;
&lt;h3&gt;主题&lt;/h3&gt;
&lt;p&gt;生成的博文好丑！&lt;/p&gt;
&lt;p&gt;安装主题：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yaourt pelican-themes
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;不是archlinux系统的话就这样：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone https://github.com/getpelican/pelican-themes.git
&lt;span class="nb"&gt;cd&lt;/span&gt; pelican-themes
pelican-themes -i tuxlite_tbs
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;其中tuxlite_tbs是选择使用的主题，&lt;a href="http://github.com/getpelican/pelican-themes"&gt;pelican主题的Github目录&lt;/a&gt;下几乎每个都提供了预览.&lt;/p&gt;
&lt;p&gt;然后，在配置文件&lt;code&gt;pelicanconf.py&lt;/code&gt;中添加：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;THEME&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;tuxlite_tbs&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;重新make，就生成了带有选定主题的页面。&lt;/p&gt;
&lt;h3&gt;评论系统&lt;/h3&gt;
&lt;p&gt;使用&lt;a href="http://disqus.com/"&gt;Disqus&lt;/a&gt;作为评论系统，注册帐号后直接在pelicanconf.conf中添加:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;DISQUS_SITENAME&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;your_shortname&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;站长工具&lt;/h3&gt;
&lt;p&gt;使用&lt;a href="http://www.google.com/webmasters/‎"&gt;google webmaster tools&lt;/a&gt;，申请之后会提示需要&lt;code&gt;sitemap&lt;/code&gt;，于是需要用&lt;code&gt;pelican&lt;/code&gt;的&lt;code&gt;sitemap&lt;/code&gt;插件：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone https://github.com/getpelican/pelican-plugins
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;再在&lt;code&gt;pelicanconf.py&lt;/code&gt;中加入：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;PLUGIN_PATH&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pelican-plugins&amp;quot;&lt;/span&gt;

&lt;span class="n"&gt;PLUGINS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;sitemap&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c1"&gt;## 配置sitemap 插件&lt;/span&gt;
&lt;span class="n"&gt;SITEMAP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;format&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;xml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;priorities&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;articles&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;0.7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;indexes&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;pages&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;changefreqs&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;articles&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;daily&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;indexes&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;monthly&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;pages&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;monthly&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;To be continued&lt;/h3&gt;
&lt;p&gt;暂时就这样～ 当然还有好多东西要做，Analytics、Webmaster等等。。。&lt;/p&gt;</content><category term="blog"></category><category term="GitHub"></category><category term="Pelican"></category></entry><entry><title>Android禁止安装360手机助手</title><link href="https://x7blog.info/archives/ban_360_on_android.html" rel="alternate"></link><published>2013-08-07T00:00:00+08:00</published><updated>2013-08-07T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-08-07:/archives/ban_360_on_android.html</id><summary type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101ozui.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;360太讨厌了，还老有人用我手机调试，一插他们电脑，马上就要给我装上360,于是就有了下边的招：&lt;/p&gt;
&lt;p&gt;android程序在手机上在&lt;code&gt;/data/app/&lt;/code&gt;目录下，考虑在此位置放一个360相同包名的文件，想让它安装的时候不能覆盖&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;adb shell
su
touch /data/app/com.qihoo.appstore-1.apk
chattr +i /data/app/com.qihoo.appstore-1.apk
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;尝试安装，软件装到手机时成功的禁止掉，但是还是能被安装到sd卡，于是采取占用&lt;code&gt;data&lt;/code&gt;文件夹的方式：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;adb shell
su
touch /data/data/com.qihoo.appstore
chattr +i /data/data …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101ozui.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;360太讨厌了，还老有人用我手机调试，一插他们电脑，马上就要给我装上360,于是就有了下边的招：&lt;/p&gt;
&lt;p&gt;android程序在手机上在&lt;code&gt;/data/app/&lt;/code&gt;目录下，考虑在此位置放一个360相同包名的文件，想让它安装的时候不能覆盖&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;adb shell
su
touch /data/app/com.qihoo.appstore-1.apk
chattr +i /data/app/com.qihoo.appstore-1.apk
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;尝试安装，软件装到手机时成功的禁止掉，但是还是能被安装到sd卡，于是采取占用&lt;code&gt;data&lt;/code&gt;文件夹的方式：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;adb shell
su
touch /data/data/com.qihoo.appstore
chattr +i /data/data/com.qihoo.appstore
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;再尝试安装，无论是安装到手机还是sd卡都被禁止了：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~ % adb install -s com.qihoo.appstore-1.apk
&lt;span class="m"&gt;4058&lt;/span&gt; KB/s &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;3737068&lt;/span&gt; bytes in &lt;span class="m"&gt;0&lt;/span&gt;.899s&lt;span class="o"&gt;)&lt;/span&gt;
        pkg: /sdcard/tmp/com.qihoo.appstore-1.apk
Failure &lt;span class="o"&gt;[&lt;/span&gt;INSTALL_FAILED_UID_CHANGED&lt;span class="o"&gt;]&lt;/span&gt;
~ % adb install com.qihoo.appstore-1.apk
&lt;span class="m"&gt;3713&lt;/span&gt; KB/s &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;3737068&lt;/span&gt; bytes in &lt;span class="m"&gt;0&lt;/span&gt;.982s&lt;span class="o"&gt;)&lt;/span&gt;
        pkg: /data/local/tmp/com.qihoo.appstore-1.apk
Failure &lt;span class="o"&gt;[&lt;/span&gt;INSTALL_FAILED_UID_CHANGED&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Android"></category></entry><entry><title>从源码编译Android系统</title><link href="https://x7blog.info/archives/build_android_from_source.html" rel="alternate"></link><published>2013-07-29T00:00:00+08:00</published><updated>2013-07-29T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-07-29:/archives/build_android_from_source.html</id><summary type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101oqvu.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Android"&gt;Android - ArchWiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://source.android.com/source/initializing.html"&gt;Initializing a Build Environment | Android Developers&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://forum.xda-developers.com/showthread.php?t=2259929"&gt;[TUT] Configuring Arch Linux to build Android - xda-developers&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先在32位archlinux上尝试，最后发现必须要64位的才行。。。最后转战到ubuntu 10.04 server&lt;/p&gt;
&lt;h3&gt;arch上的尝试：&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;系统需求，32位系统需要这么一堆东西：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gcc git gnupg flex bison gperf sdl wxgtk squashfs-tools curl ncurses zlib schedtool perl-switch zip unzip libxslt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;64位系统还需要：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lib32-zlib lib32-ncurses lib32-readline gcc-libs-multilib …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101oqvu.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Android"&gt;Android - ArchWiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://source.android.com/source/initializing.html"&gt;Initializing a Build Environment | Android Developers&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://forum.xda-developers.com/showthread.php?t=2259929"&gt;[TUT] Configuring Arch Linux to build Android - xda-developers&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;首先在32位archlinux上尝试，最后发现必须要64位的才行。。。最后转战到ubuntu 10.04 server&lt;/p&gt;
&lt;h3&gt;arch上的尝试：&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;系统需求，32位系统需要这么一堆东西：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gcc git gnupg flex bison gperf sdl wxgtk squashfs-tools curl ncurses zlib schedtool perl-switch zip unzip libxslt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;64位系统还需要：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lib32-zlib lib32-ncurses lib32-readline gcc-libs-multilib gcc-multilib lib32-gcc-libs
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;需要&lt;code&gt;jdk6&lt;/code&gt;，古董级别的，源里和AUR里都没有了，去王八壳网站&lt;a href="http://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-javase6-419409.html"&gt;下载&lt;/a&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;下好了放到&lt;code&gt;/opt&lt;/code&gt;下，给&lt;code&gt;x&lt;/code&gt;权限，执行,安装到&lt;code&gt;/opt/jdk1.6.0_45&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo chmod +x jdk-6u45-linux-i586.bin
sudo ./jdk-6u45-linux-i586.bin
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;然后搞&lt;code&gt;python2&lt;/code&gt;，为了让系统默认&lt;code&gt;python&lt;/code&gt;为&lt;code&gt;python2&lt;/code&gt;，需要修改&lt;code&gt;PATH&lt;/code&gt;，顺道把&lt;code&gt;java&lt;/code&gt;也改了。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir android-build
&lt;span class="nb"&gt;cd&lt;/span&gt; android-build
ln -s &lt;span class="k"&gt;$(&lt;/span&gt;which python2&lt;span class="k"&gt;)&lt;/span&gt; python
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/opt/android-build:/opt/jdk1.6.0_45/bin:&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;进到源码目录，执行Google提供的设定环境变量的脚本,非让我用&lt;code&gt;bash&lt;/code&gt;，&lt;code&gt;zsh&lt;/code&gt;不给用。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;bash
&lt;span class="nb"&gt;source&lt;/span&gt; build/envsetup.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;code&gt;lunch&lt;/code&gt;，然后就杯具了。。。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/bin/bash: prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.6/bin/arm-linux-androideabi-gcc: cannot execute binary file
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;谷了一歌，说需要x64系统。。。。闹哪样 要x64你就别提供x86的包啊，唬我呢。。。&lt;/p&gt;
&lt;h3&gt;于是吧源码搞到服务器上去&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;装这么一堆依赖：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get install git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev libc6-dev lib32ncurses5-dev ia32-libs x11proto-core-dev libx11-dev lib32readline5-dev lib32z-dev libgl1-mesa-dev g++-multilib mingw32 tofrodos python-markdown libxml2-utils xsltproc
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;重新下载64位的王八壳的java（openjdk不让，必须oracel的），和前边一样，然后改&lt;code&gt;PATH&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/opt/jdk1.6.0_45/bin:&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;配置&lt;code&gt;ccache&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;USE_CCACHE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;CCACHE_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/root/android-build/ccache
prebuilts/misc/linux-x86/ccache/ccache -M 50G
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;编译,就可以了&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make -j4
&lt;/pre&gt;&lt;/div&gt;</content><category term="Android"></category><category term="Linux"></category></entry><entry><title>hadoop on archlinux</title><link href="https://x7blog.info/archives/hadoop_on_archlinux.html" rel="alternate"></link><published>2013-06-21T00:00:00+08:00</published><updated>2013-06-21T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-06-21:/archives/hadoop_on_archlinux.html</id><summary type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101nu7o.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Hadoop"&gt;Hadoop - ArchWiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://hadoop.apache.org/docs/stable/single_node_setup.html"&gt;Single Node Setup&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yaourt hadoop
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;主要目录是这个：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/etc/hadoop/
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;当然配置文件还是在这里。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/etc/hadoop/
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;检查java环境配置。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$JAVA_HOME&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;安装时生成了rsa密钥一对，还需要将本地用户的公钥添加到&lt;code&gt;/etc/hadoop/.ssh/authorized_keys&lt;/code&gt;,用于&lt;code&gt;ssh&lt;/code&gt;验证。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;格式化新的分布式文件系统&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hadoop namenode -format
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;启动服务,需要防火墙打开&lt;code&gt;9000&lt;/code&gt;和&lt;code&gt;9001&lt;/code&gt;端口，即使单机hadoop也需要，不明&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;bin/start-all.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;或者启动&lt;code&gt;systemd&lt;/code&gt;的一排service&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;启动后运行example测试，首先把测试用的文件写到&lt;code&gt;hadoop …&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101nu7o.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Hadoop"&gt;Hadoop - ArchWiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://hadoop.apache.org/docs/stable/single_node_setup.html"&gt;Single Node Setup&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yaourt hadoop
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;主要目录是这个：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/etc/hadoop/
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;当然配置文件还是在这里。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/etc/hadoop/
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;检查java环境配置。&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$JAVA_HOME&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;安装时生成了rsa密钥一对，还需要将本地用户的公钥添加到&lt;code&gt;/etc/hadoop/.ssh/authorized_keys&lt;/code&gt;,用于&lt;code&gt;ssh&lt;/code&gt;验证。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;格式化新的分布式文件系统&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hadoop namenode -format
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;启动服务,需要防火墙打开&lt;code&gt;9000&lt;/code&gt;和&lt;code&gt;9001&lt;/code&gt;端口，即使单机hadoop也需要，不明&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;bin/start-all.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;或者启动&lt;code&gt;systemd&lt;/code&gt;的一排service&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;启动后运行example测试，首先把测试用的文件写到&lt;code&gt;hadoop fs&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hadoop fs -put /etc/hadoop input
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;运行测试&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hadoop jar /usr/lib/hadoop/hadoop-examples-*.jar grep input output &lt;span class="s1"&gt;&amp;#39;dfs[a-z.]+&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;查看结果&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;hadoop fs -get output output
cat output/*
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="Hadoop"></category></entry><entry><title>LFS编译shadow之后设置root密码出错解决</title><link href="https://x7blog.info/archives/lfs_root_passwd.html" rel="alternate"></link><published>2013-01-22T00:00:00+08:00</published><updated>2013-01-22T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2013-01-22:/archives/lfs_root_passwd.html</id><summary type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101hvh1.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;按照&lt;a href="http://www.linuxfromscratch.org/lfs/download.html"&gt;lfs book&lt;/a&gt;编译安装配置&lt;code&gt;shadow&lt;/code&gt;之后没法修改root密码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root:/sources/shadow-4.1.5.1# passwd root
Changing password for root
Enter the new password (minimum of 5 characters)
Please use a combination of upper and lower case letters and numbers.
Bad password: too short.  
Warning: weak password (enter it again …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101hvh1.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;按照&lt;a href="http://www.linuxfromscratch.org/lfs/download.html"&gt;lfs book&lt;/a&gt;编译安装配置&lt;code&gt;shadow&lt;/code&gt;之后没法修改root密码：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root:/sources/shadow-4.1.5.1# passwd root
Changing password for root
Enter the new password (minimum of 5 characters)
Please use a combination of upper and lower case letters and numbers.
Bad password: too short.  
Warning: weak password (enter it again to use it anyway).
passwd: password changed.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;不给输密码的机会，直接跑过去了。经过反复重新解包编译安装… 最后才发现错误原因：&lt;/p&gt;
&lt;p&gt;之前重启过host，重新进入chroot之前忘记挂载系统虚拟文件了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@ant-arch /media/lfs # mount -v --bind /dev dev                pts/0 19:28
mount: /dev binded on /media/lfs/dev
root@ant-arch /media/lfs # mount -vt devpts devpts dev/pts         pts/0 19:28
mount: devpts mounted on /media/lfs/dev/pts
root@ant-arch /media/lfs # mount -vt proc proc proc                pts/0 19:28
mount: proc mounted on /media/lfs/proc
root@ant-arch /media/lfs # mount -vt sysfs sysfs sys               pts/0 19:28
mount: sysfs mounted on /media/lfs/sys
root@ant-arch /media/lfs # mount -vt tmpfs shm dev/shm             pts/0 19:28
mount: shm mounted on /media/lfs/dev/shm
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然后再chroot，修改密码，一切正常了：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@ant-arch /media/lfs # chroot /media/lfs /tools/bin/env -i \   pts/0 19:29
HOME=/root \
TERM=&amp;quot;$TERM&amp;quot; \
PS1=&amp;#39;\u:\w\$ &amp;#39; \
PATH=/bin:/usr/bin:/sbin:/usr/sbin:/tools/bin \
/tools/bin/bash --login +h
root:/# passwd root
Changing password for root
Enter the new password (minimum of 5 characters)
Please use a combination of upper and lower case letters and numbers.
New password:
Bad password: too simple. 
Warning: weak password (enter it again to use it anyway).
New password:
Re-enter new password:
passwd: password changed.
root:/#
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="lfs"></category></entry><entry><title>grub2直接引导iso镜像</title><link href="https://x7blog.info/archives/grub2_boot_from_iso.html" rel="alternate"></link><published>2012-11-25T00:00:00+08:00</published><updated>2012-11-25T00:00:00+08:00</updated><author><name>x7</name></author><id>tag:x7blog.info,2012-11-25:/archives/grub2_boot_from_iso.html</id><summary type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101f2an.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Grub"&gt;GRUB - ArchWiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://askubuntu.com/questions/141940/how-to-boot-live-iso-images"&gt;grub2 - How to boot live iso images? - Ask Ubuntu&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://forum.ubuntu.org.cn/viewtopic.php?f=139&amp;amp;t=393256"&gt;打造自己的多功能USB启动盘——grub2引导WinPE、Archlinux安装镜像和Ubuntu liveCD&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;U盘准备&lt;/h3&gt;
&lt;p&gt;格式fat32，卷标 zzz。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo grub-install --boot-directory&lt;span class="o"&gt;=&lt;/span&gt; --no-floppy --target&lt;span class="o"&gt;=&lt;/span&gt;i386-pc --recheck /dev/sd
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;目录放置&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;考虑到方便win下使用没有分两个区。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/livecd&lt;/code&gt;需要引导的iso镜像 不必解压  暂时只用到arch ubuntu&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/livecd/grub&lt;/code&gt;在arch中用grub-install安装的grub2文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/livecd/grub4dos&lt;/code&gt;用于引导windows镜像&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;配置文件&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;grub.cfg&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# grub.cfg
# for …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;搬迁自&lt;a href="http://blog.sina.com.cn/s/blog_76db5e270101f2an.html"&gt;以前的新浪博客&lt;/a&gt;～&lt;/p&gt;
&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://wiki.archlinux.org/index.php/Grub"&gt;GRUB - ArchWiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://askubuntu.com/questions/141940/how-to-boot-live-iso-images"&gt;grub2 - How to boot live iso images? - Ask Ubuntu&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://forum.ubuntu.org.cn/viewtopic.php?f=139&amp;amp;t=393256"&gt;打造自己的多功能USB启动盘——grub2引导WinPE、Archlinux安装镜像和Ubuntu liveCD&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;U盘准备&lt;/h3&gt;
&lt;p&gt;格式fat32，卷标 zzz。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo grub-install --boot-directory&lt;span class="o"&gt;=&lt;/span&gt; --no-floppy --target&lt;span class="o"&gt;=&lt;/span&gt;i386-pc --recheck /dev/sd
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;目录放置&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;考虑到方便win下使用没有分两个区。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/livecd&lt;/code&gt;需要引导的iso镜像 不必解压  暂时只用到arch ubuntu&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/livecd/grub&lt;/code&gt;在arch中用grub-install安装的grub2文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;/livecd/grub4dos&lt;/code&gt;用于引导windows镜像&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;配置文件&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;grub.cfg&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# grub.cfg
# for livecd
# by zzz

set menu_color_normal=light-blue/black
set menu_color_highlight=light-cyan/blue

set default=0
insmod part_msdos
insmod ext2
insmod ntfs

# archlinux i686
menuentry &amp;#39;Arch GNU/Linux i686&amp;#39; {
    set isofile=&amp;#39;/livecd/archlinux-2012.10.06-dual.iso&amp;#39;
    set isolabel=&amp;#39;ARCH_201210&amp;#39;
    set disklabel=&amp;#39;zzz&amp;#39;
    loopback loop (hd0,1)$isofile
    linux (loop)/arch/boot/i686/vmlinuz archisolabel=$isolabel img_dev=/dev/disk/by-label/$disklabel img_loop=$isofile
    initrd (loop)/arch/boot/i686/archiso.img
}

# archlinux x86_64
menuentry &amp;#39;Arch GNU/Linux x86_64&amp;#39; {
    set isofile=&amp;#39;/livecd/archlinux-2012.10.06-dual.iso&amp;#39;
    set isolabel=&amp;#39;ARCH_201210&amp;#39;
    set disklabel=&amp;#39;zzz&amp;#39;
    loopback loop (hd0,1)$isofile
    linux (loop)/arch/boot/x86_64/vmlinuz archisolabel=$isolabel img_dev=/dev/disk/by-label/$disklabel img_loop=$isofile
    initrd (loop)/arch/boot/x86_64/archiso.img
}

# ubuntu 12.04
menuentry &amp;#39;Ubuntu 12.04.1 LTS&amp;#39; {
    set isofile=&amp;#39;/livecd/ubuntu-12.04-desktop-i386.iso&amp;#39;
    loopback loop $isofile
    linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile ro
    initrd (loop)/casper/initrd.lz
}

# grub4dos
menuentry &amp;#39;Grub4dos&amp;#39; {
    linux /livecd/grub4dos/grub.exe --config-file=/livecd/grub4dos/menu.lst
}
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;code&gt;grub4dos&lt;/code&gt;配置&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# menu.lst

color light-blue/black light-cyan/blue

title en Windows 7 x86 ultimate sp1
map (hd0,0)/livecd/en_windows_7_ultimate_with_sp1_x86_dvd_u_677460.iso (0xff)
map --hook
chainloader (0xff)
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="grub2"></category></entry></feed>